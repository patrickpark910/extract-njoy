User Input for NJOY99, updated through version 396.

Search down for the desired module in caps:
NJOY, RECONR, BROADR, UNRESR, HEATR, THERMR, GROUPR, GAMINR, ERRORJ,
COVR, MODER, DTFR, CCCCR, MATXSR, RESXSR, ACER, POWR, WIMSR, PLOTR,
VIEWR, MIXR, PURR, LEAPR, GASPR

NJOY
      program njoy                                                         njoy.3    
c                                                                          njoy.4    
c     ******************************************************************   njoy.5    
c     *                                                                *   njoy.6    
c     *    njoy nuclear data processing system                         *   njoy.7    
c     *    version 99.396                                              *   vers.5    
c     *    8 august 2013                                               *   vers.6    
c     *                                                                *   njoy.10   
c     ******************************************************************   njoy.11   
c     *                                                                *   njoy.12   
c     * njoy is a system of processing modules intended to convert     *   njoy.13   
c     * evaluated nuclear data in the endf format into forms useful    *   njoy.14   
c     * for practical applications.                                    *   njoy.15   
c     *                                                                *   njoy.16   
c     * reconr...reconstruct pointwise cross sections from endf/b      *   njoy.17   
c     *     resonance parameters and interpolation schemes.            *   njoy.18   
c     *                                                                *   njoy.19   
c     * broadr...doppler broaden and thin pointwise cross sections.    *   njoy.20   
c     *                                                                *   njoy.21   
c     * unresr...compute effective pointwise self-shielded cross       *   njoy.22   
c     *     sections in the unresolved energy range.                   *   njoy.23   
c     *                                                                *   njoy.24   
c     * heatr...compute heat production cross sections (kerma)         *   njoy.25   
c     *     and damage energy production.                              *   njoy.26   
c     *                                                                *   njoy.27   
c     * thermr...generate neutron scattering cross sections and        *   njoy.28   
c     *     point-to-point scattering kernels in the thermal range     *   njoy.29   
c     *     for free or bound atoms.                                   *   njoy.30   
c     *                                                                *   njoy.31   
c     * groupr...generate self-shielded multigroup cross sections and  *   njoy.32   
c     *     group-to-group scattering and photon production matrices.  *   njoy.33   
c     *                                                                *   njoy.34   
c     * gaminr...compute multigroup photon interaction cross sections, *   njoy.35   
c     *     scattering matrices, and heat production.                  *   njoy.36   
c     *                                                                *   njoy.37   
c     * errorr...construct multigroup covariance matrices.             *   njoy.38   
c     *                                                                *   njoy.39   
c     * covr...process covariance data from errorr                     *   njoy.40   
c     *                                                                *   njoy.41   
c     * moder...convert between endf/b standard coded mode and the     *   njoy.42   
c     *     njoy blocked binary mode.                                  *   njoy.43   
c     *                                                                *   njoy.44   
c     * dtfr...output and plot multigroup data for discrete ordinates  *   njoy.45   
c     *     transport codes.                                           *   njoy.46   
c     *                                                                *   njoy.47   
c     * ccccr...format multigroup data into the cccc standard          *   njoy.48   
c     *     interface files isotxs, brkoxs, and dlayxs.                *   njoy.49   
c     *                                                                *   njoy.50   
c     * matxsr...convert multigroup data into the comprehensive matxs  *   njoy.51   
c     *     cross section interface format.                            *   njoy.52   
c     *                                                                *   njoy.53   
c     * resxsr...prepare a cccc-like file of pointwise resonance       *   njoy.54   
c     *     cross sections for thermal flux calculations               *   njoy.55   
c     *                                                                *   njoy.56   
c     * acer...prepare library for the los alamos continuous energy    *   njoy.57   
c     *     monte-carlo code mcnp.                                     *   njoy.58   
c     *                                                                *   njoy.59   
c     * powr...convert multigroup data into libraries for the thermal  *   njoy.60   
c     *     powr reactor codes epri-cell and epri-cpm.                 *   njoy.61   
c     *                                                                *   njoy.62   
c     * wimsr...convert multigroup data into libraries for the         *   njoy.63   
c     *     reactor assembly codes wims-d or wims-e.                   *   njoy.64   
c     *                                                                *   njoy.65   
c     * plotr...plot endf, pendf, gendf, or exp. cross sections,       *   njoy.66   
c     *     distributions, or matrices.                                *   njoy.67   
c     *                                                                *   njoy.68   
c     * viewr...view plots from plotr, dtfr, covr, etc. in postscript  *   njoy.69   
c     *                                                                *   njoy.70   
c     * mixr...mix file 3 cross sections (for example, to make         *   njoy.71   
c     *     elemental cross sections) for plotting, etc.               *   njoy.72   
c     *                                                                *   njoy.73   
c     * purr...generate unresolved-resonance probability tables        *   njoy.74   
c     *     for the mcnp monte carlo code                              *   njoy.75   
c     *                                                                *   njoy.76   
c     * leapr...generate s(alpha,beta) for thermal moderators          *   njoy.77   
c     *                                                                *   njoy.78   
c     * gaspr...add gas production (mt203-207) to pendf                *   njoy.79   
c     *                                                                *   njoy.80   
c     * each module is an essentially independent code segment.  the   *   njoy.81   
c     * main program controls the order in which modules are used      *   njoy.82   
c     * and contains the utility subroutines used by all modules.      *   njoy.83   
c     *                                                                *   njoy.84   
c     *---input specifications (free format)---------------------------*   njoy.85   
c     *                                                                *   njoy.86   
c     * card 1       module option                                     *   njoy.87   
c     *                                                                *   njoy.88   
c     *    module    six character module name, e.g., reconr.          *   njoy.89   
c     *              it is not necessary to use quotes.                *   njoy.90   
c     *                                                                *   njoy.91   
c     *          repeat card 1 for each module desired, and            *   njoy.92   
c     *          use the name "stop" to terminate program.             *   njoy.93   
c     *                                                                *   njoy.94   
c     * see the comments at the start of each module for               *   njoy.95   
c     * its specific input instructions.                               *   njoy.96   
c     *                                                                *   njoy.97   
c     *--- code conversion --------------------------------------------*   njoy.98   
c     *                                                                *   njoy.99   
c     * code conversion is handled using the "*if" constructs of       *   njoy.100  
c     * the upd code (which is a code for maintaining fortran codes    *   njoy.101  
c     * similar to update).  the logical variables that can be         *   njoy.102  
c     * set are the following:                                         *   njoy.103  
c     *                                                                *   njoy.104  
c     *   sw  -- set for short-word machines (32 bit).  leave          *   njoy.105  
c     *             unset for 64 bit machines.                         *   njoy.106  
c     *                                                                *   njoy.107  
c     ******************************************************************   njoy.108  

RECONR
      subroutine reconr                                                  reconr.3    
c                                                                        reconr.4    
c     ****************************************************************** reconr.5    
c     *                                                                * reconr.6    
c     * reconstruct pointwise cross sections                           * reconr.7    
c     *                                                                * reconr.8    
c     * resonance cross sections are calculated using the methods of   * reconr.9    
c     * resend, with modifications to the method of generating the     * reconr.10   
c     * energy grid and the method of combining resonance and          * reconr.11   
c     * background cross sections.                                     * reconr.12   
c     *                                                                * reconr.13   
c     * this program generates an energy grid which is the union of    * reconr.14   
c     * an input grid (if any), the resonance energies (if any), and   * reconr.15   
c     * the energies of cross sections in mf3 and mf13 (or mf23).      * reconr.16   
c     * the pointwise cross sections are then computed on this grid    * reconr.17   
c     * and points are added so that the resonance cross sections and  * reconr.18   
c     * any cross sections represented by non-linear interpolation     * reconr.19   
c     * are reproduced within a specified tolerance by linear inter-   * reconr.20   
c     * polation.  psi-chi reconstruction can be used if desired.      * reconr.21   
c     * sections which are not cross sections (mu,nu) and photon       * reconr.22   
c     * multiplicities (mf12) are not processed.  redundant reactions  * reconr.23   
c     * are reconstructed to be the sum of their parts.  the pendf     * reconr.24   
c     * tape contains point cross sections in mf3 and mf13 (or mf23)   * reconr.25   
c     * and a description of the processing in mf1.  the mf1 diction-  * reconr.26   
c     * ary is updated.  the c1 and c2 fields of the second card in    * reconr.27   
c     * mf1 contain the temperature and reconstruction tolerance       * reconr.28   
c     * respectively.  an mf2 appropriate to no resonance parameters   * reconr.29   
c     * is constructed with the potential scattering length added.     * reconr.30   
c     *                                                                * reconr.31   
c     * if unresolved parameters are present, the infinitely dilute    * reconr.32   
c     * cross sections are computed on a special energy grid chosen    * reconr.33   
c     * to preserve the required interpolation properties.  this       * reconr.34   
c     * table is added to the pendf tape using a special format in     * reconr.35   
c     * mf2/mt152, and the table is also used to compute the           * reconr.36   
c     * uresolved contributions in mf3.  this allows resolved          * reconr.37   
c     * resonance cross sections which overlap the resolved range      * reconr.38   
c     * to be recovered by subtraction.                                * reconr.39   
c     *                                                                * reconr.40   
c     *---input specifications (free format)---------------------------* reconr.41   
c     *                                                                * reconr.42   
c     * card 1                                                         * reconr.43   
c     *    nendf    unit for endf/b tape                               * reconr.44   
c     *    npend    unit for pendf tape                                * reconr.45   
c     * card 2                                                         * reconr.46   
c     *    tlabel   66 character label for new pendf tape              * reconr.47   
c     *             delimited with quotes, ended with /.               * reconr.48   
c     * card 3                                                         * reconr.49   
c     *    mat      material to be reconstructed                       * reconr.50   
c     *    ncards   number of cards of descriptive data for new mf1    * reconr.51   
c     *             (default=0)                                        * reconr.52   
c     *    ngrid    number of user energy grid points to be added.     * reconr.53   
c     *             (default=0)                                        * reconr.54   
c     * card 4                                                         * reconr.55   
c     *    err      fractional reconstruction tolerance used when      * reconr.56   
c     *             resonance-integral error criterion (see errint)    * reconr.57   
c     *             is not satisfied.                                  * reconr.58   
c     *    tempr    reconstruction temperature (deg kelvin)            * reconr.59   
c     *             (default=0)                                        * reconr.60   
c     *    errmax   fractional reconstruction tolerance used when      * reconr.61   
c     *             resonance-integral error criterion is satisfied    * reconr.62   
c     *             (errmax.ge.err, default=10*err)                    *   up79.5    
c     *    errint   maximum resonance-integral error (in barns)        * reconr.64   
c     *             per grid point (default=err/20000)                 *   up79.7    
c     *             (note: the max cross section difference for        * reconr.66   
c     *             linearization, errlim, and for reconstruction,     * reconr.67   
c     *             errmin, are also tied to errint.  to get maximum   * reconr.68   
c     *             accuracy, set errint to a very small number.       * reconr.69   
c     *             for economical production, use the defaults.)      * reconr.70   
c     * card 5                                                         * reconr.71   
c     *    cards    ncards of descriptive comments for mt451           * reconr.72   
c     *             each card delimited with quotes, ended with /.     * reconr.73   
c     * card 6                                                         * reconr.74   
c     *    enode    users energy grid points                           * reconr.75   
c     *                                                                * reconr.76   
c     *     cards 3, 4, 5, 6 must be input for each material desired   * reconr.77   
c     *     mat=0/ terminates execution of reconr.                     * reconr.78   
c     *                                                                * reconr.79   
c     ****************************************************************** reconr.80   

BROADR
      subroutine broadr                                                  broadr.3    
c                                                                        broadr.4    
c     ****************************************************************** broadr.5    
c     *                                                                * broadr.6    
c     * doppler broaden and thin neutron point cross sections          * broadr.7    
c     *                                                                * broadr.8    
c     * a modified version of the kernel broadening method developed   * broadr.9    
c     * for sigma1 (d.e.cullen, llnl) is used.  cross sections         * broadr.10   
c     * for low threshold reactions are unionized on the grid of the   * broadr.11   
c     * total cross section, then broadened and thinned in parallel.   * broadr.12   
c     * high threshold reactions are not broadened.  the total and     * broadr.13   
c     * and nonelastic are reconstructed to equal the sum of parts.    * broadr.14   
c     *                                                                * broadr.15   
c     * the output energy grid for broadened cross sections is         * broadr.16   
c     * constructed adaptively (as in reconr) so that the results      * broadr.17   
c     * represent the true function within the given tolerance.        * broadr.18   
c     * energy values are either removed from the original grid, or    * broadr.19   
c     * new values are added between the original points.  thus, a     * broadr.20   
c     * given energy range can have more or fewer points than the      * broadr.21   
c     * original energy grid.                                          * broadr.22   
c     *                                                                * broadr.23   
c     * for high temperatures and low energies where the original      * broadr.24   
c     * sigma1 breaks down, a new direct expansion of the doppler      * broadr.25   
c     * integral is used.                                              * broadr.26   
c     *                                                                * broadr.27   
c     * if the temperature is close to 293.6 K (.0253 ev), broadr      * broadr.28   
c     * computes and displays thermal cross sections, maxwellian       * broadr.29   
c     * integrals (one-group thermal cross sections), g-factors,       * broadr.30   
c     * integral ratios (eta, alpha), the k1 integral and the          * broadr.31   
c     * corresponding 1/v-equivalent, and resonance integrals.         * broadr.32   
c     *                                                                * broadr.33   
c     * the results are written out in pendf format with each          * broadr.34   
c     * temperature represented as a different mat.  dictionaries      * broadr.35   
c     * are corrected to reflect the effects of thinning.              * broadr.36   
c     *                                                                * broadr.37   
c     *---input specifications (free format)---------------------------* broadr.38   
c     *                                                                * broadr.39   
c     * card 1                                                         * broadr.40   
c     *    nendf    input endf tape (for thermal nubar only)           * broadr.41   
c     *    nin      input pendf tape                                   * broadr.42   
c     *    nout     output pendf tape                                  * broadr.43   
c     * card 2                                                         * broadr.44   
c     *    mat1     material to be processed                           * broadr.45   
c     *    ntemp2   number of final temperatures (maximum=10)          * broadr.46   
c     *    istart   restart (0 no, 1 yes, default 0)                   * broadr.47   
c     *    istrap   bootstrap (0 no, 1 yes, default 0)                 * broadr.48   
c     *    temp1    starting temperature from nin (default=0.k)        * broadr.49   
c     * card 3                                                         * broadr.50   
c     *    errthn   fractional tolerance for thinning                  * broadr.51   
c     *    thnmax   max. energy for broadening and thinning            * broadr.52   
c     *             (default=1 mev)                                    * broadr.53   
c     *    errmax   fractional tolerance used when integral criterion  * broadr.54   
c     *             is satisfied (same usage as in reconr)             * broadr.55   
c     *             (errmax.ge.errthn, default=10*errthn)              *   up78.5    
c     *    errint   parameter to control integral thinning             * broadr.57   
c     *             (usage as in reconr) (default=errthn/20000)        *   up78.7    
c     *             set very small to turn off integral thinning.      * broadr.59   
c     *      (a good choice for the convergence parameters             * broadr.60   
c     *       errthn, errmax, and errint is the same set of            * broadr.61   
c     *       values used in reconr)                                   * broadr.62   
c     * card 4                                                         * broadr.63   
c     *    temp2    final temperatures (deg kelvin)                    * broadr.64   
c     * card 5                                                         * broadr.65   
c     *    mat1     next mat number to be processed with these         * broadr.66   
c     *             parameters.  terminate with mat1=0.                * broadr.67   
c     *                                                                * broadr.68   
c     *---input options------------------------------------------------* broadr.69   
c     *                                                                * broadr.70   
c     * the output tape will contain the ntemp2 final temperatures     * broadr.71   
c     * specified.  it is necessary to have temp1.le.temp2(1).         * broadr.72   
c     * if temp2.eq.temp1, the data will be thinned only.              * broadr.73   
c     *                                                                * broadr.74   
c     * restart    continue broadening an existing pendf tape.  all    * broadr.75   
c     *            temperatures are copied through temp1.  additional  * broadr.76   
c     *            final temperatures are added by starting with the   * broadr.77   
c     *            data at temp1.                                      * broadr.78   
c     *                                                                * broadr.79   
c     * bootstrap  if bootstrap is not requested, each final tempera-  * broadr.80   
c     *            ture is generated by broadening directly from       * broadr.81   
c     *            temp1 to temp2.  if bootstrap is requested, each    * broadr.82   
c     *            final temperature is broadened from the preceding   * broadr.83   
c     *            temperature.  this option is faster due to the      * broadr.84   
c     *            thinning in the previous step.  however, errors     * broadr.85   
c     *            accumulate.                                         * broadr.86   
c     *                                                                * broadr.87   
c     * thnmax     the upper limit for broadening and thinning is the  * broadr.88   
c     *            lowest of the input value of thnmax, the lowest     * broadr.89   
c     *            reaction threshold, or the start of the unresolved  * broadr.90   
c     *            range.  if there is resolved-unresolved overlap,    * broadr.91   
c     *            the overlap region is included in the broadening.   * broadr.92   
c     *            a negative value of thnmax will override the        * broadr.93   
c     *            resolved and threshold limits.  This allows the     * broadr.94   
c     *            first few threshold reactions to be broadened if    * broadr.95   
c     *            desired.  the magnitude of thnmax must be chosen    * broadr.96   
c     *            to keep the number of broadenable reactions less    * broadr.97   
c     *            than or equal to the maximum of ntt (10).           * broadr.98   
c     *                                                                * broadr.99   
c     ****************************************************************** broadr.100  

UNRESR
      subroutine unresr                                                  unresr.3    
c                                                                        unresr.4    
c     ****************************************************************** unresr.5    
c     *                                                                * unresr.6    
c     * compute unresolved resonance cross-sections                    * unresr.7    
c     *                                                                * unresr.8    
c     * the method of etox is used to compute self-shielded            * unresr.9    
c     * unresolved resonance cross-sections on the energy grid of      * unresr.10   
c     * the unresolved parameters.  subsequent interpolation is        * unresr.11   
c     * to be on the cross-sections and not on the parameters.         * unresr.12   
c     * additional energy grid points are added at quarter lethargy    * unresr.13   
c     * intervals if only three or fewer grid points are found.        * unresr.14   
c     * the accurate hwang quadrature set is used for the integrals.   * unresr.15   
c     *                                                                * unresr.16   
c     *---input specifications (free format)---------------------------* unresr.17   
c     *                                                                * unresr.18   
c     * card 1                                                         * unresr.19   
c     *   nendf   unit for endf/b tape                                 * unresr.20   
c     *   nin     unit for input pendf tape                            * unresr.21   
c     *   nout    unit for output pendf tape                           * unresr.22   
c     * card 2                                                         * unresr.23   
c     *   matd    material to be processed                             * unresr.24   
c     *   ntemp   no. of temperatures (10 max)                         * unresr.25   
c     *   nsigz   no. of sigma zeroes (10 max)                         * unresr.26   
c     *   iprint  print option (0=min, 1=max) (default=0)              * unresr.27   
c     * card 3                                                         * unresr.28   
c     *   temp    temperatures in kelvin (including zero)              * unresr.29   
c     * card 4                                                         * unresr.30   
c     *   sigz    sigma zero values (including infinity)               * unresr.31   
c     *       cards 2, 3, 4 must be input for each material desired    * unresr.32   
c     *       matd=0/ terminates execution of unresr.                  * unresr.33   
c     *                                                                * unresr.34   
c     ****************************************************************** unresr.35   

HEATR
      subroutine heatr                                                    heatr.3    
c                                                                         heatr.4    
c     ******************************************************************  heatr.5    
c     *                                                                *  heatr.6    
c     * compute heating kerma (kinetic energy release in material)     *  heatr.7    
c     * and radiation damage energy production                         *  heatr.8    
c     *                                                                *  heatr.9    
c     * the prompt kerma is computed pointwise on the grid of the      *  heatr.10   
c     * total cross section from the input pendf tape and written      *  heatr.11   
c     * onto the output pendf tape at infinite dilution using the      *  heatr.12   
c     * 300 series of mt numbers.  all temperatures on the input pendf *  heatr.13   
c     * tape for the desired material are processed.  the dictionary   *  heatr.14   
c     * is revised.  reaction q values are obtained from the endf/b    *  heatr.15   
c     * tape unless the user enters his own value.  partial kermas     *  heatr.16   
c     * can be requested for self-shielding calculations or other      *  heatr.17   
c     * purposes.  the code uses the energy balance method where       *  heatr.18   
c     * photon files are available and deposits all photon energy      *  heatr.19   
c     * locally when files are not available.  this assures            *  heatr.20   
c     * consistency between neutron heating and energy deposition by   *  heatr.21   
c     * subsequent photon interactions.  an exception is made for      *  heatr.22   
c     * capture where recoil is computed by momentum conservation.     *  heatr.23   
c     * photon files are used to estimate the average photon momentum  *  heatr.24   
c     * when available.  a diagnostic message is printed if the        *  heatr.25   
c     * momentum calculation leads to a significant error in           *  heatr.26   
c     * energy conservation.                                           *  heatr.27   
c     *                                                                *  heatr.28   
c     * if desired, the energy-balance kerma factors can be compared   *  heatr.29   
c     * with conservative kinematic limits (set iprint=2).             *  heatr.30   
c     * a plot file for viewr can be automatically prepared.           *  heatr.31   
c     *                                                                *  heatr.32   
c     * damage energy is computed using the lindhard electronic        *  heatr.33   
c     * screening damage function with a displacement threshold        *  heatr.34   
c     * from a table of default values for important elements          *  heatr.35   
c     * or a value provided by the user.                               *  heatr.36   
c     *                                                                *  heatr.37   
c     *---input specifications (free format)---------------------------*  heatr.38   
c     *                                                                *  heatr.39   
c     * card 1                                                         *  heatr.40   
c     *    nendf    unit for endf/b tape                               *  heatr.41   
c     *    nin      unit for input pendf tape                          *  heatr.42   
c     *    nout     unit for output pendf tape                         *  heatr.43   
c     *    nplot     unit for graphical check output                   *  heatr.44   
c     * card 2                                                         *  heatr.45   
c     *    matd     material to be processed                           *  heatr.46   
c     *    npk      number of partial kermas desired (default=0)       *  heatr.47   
c     *    nqa      number of user q values (default=0)                *  heatr.48   
c     *    ntemp    number of temperatures to process                  *  heatr.49   
c     *             (default=0, meaning all on pendf)                  *  heatr.50   
c     *    local    0/1=gamma rays transported/deposited locally       *  heatr.51   
c     *             (default=0)                                        *  heatr.52   
c     *    iprint   print (0 min, 1 max, 2 check) (default=0)          *  heatr.53   
c     *    ed       displacement energy for damage                     *  heatr.54   
c     *             (default from built-in table)                      *  heatr.55   
c     * card 3      for npk gt 0 only                                  *  heatr.56   
c     *    mtk      mt numbers for partial kermas desired              *  heatr.57   
c     *             total (mt301) will be provided automatically.      *  heatr.58   
c     *             partial kerma for reaction mt is mt+300            *  heatr.59   
c     *             and may not be properly defined unless             *  heatr.60   
c     *             a gamma file for mt is on endf tape.               *  heatr.61   
c     *             special values allowed--                           *  heatr.62   
c     *               303   non-elastic (all but mt2)                  *  heatr.63   
c     *               304   inelastic (mt51 thru 91)                   *  heatr.64   
c     *               318   fission (mt18 or mt19, 20, 21, 38)         *  heatr.65   
c     *               401   disappearance (mt102 thru 120)             *  heatr.66   
c     *               442   total photon ev-barns                      *   up85.5    
c     *               443   total kinematic kerma (high limit)         *  heatr.67   
c     *             damage energy production values--                  *  heatr.68   
c     *               444   total                                      *  heatr.69   
c     *               445   elastic (mt2)                              *  heatr.70   
c     *               446   inelastic (mt51 thru 91)                   *  heatr.71   
c     *               447   disappearance (mt102 thru 120)             *  heatr.72   
c     *          cards 4 and 5 for nqa gt 0 only                       *  heatr.73   
c     * card 4                                                         *  heatr.74   
c     *    mta      mt numbers for users q values                      *  heatr.75   
c     * card 5                                                         *  heatr.76   
c     *    qa       user specified q values (ev)                       *  heatr.77   
c     *               (if qa.ge.99.e6, read in variable qbar           *  heatr.78   
c     *                  for this reaction)                            *  heatr.79   
c     * card 5a     variable qbar (for reactions with qa flag only)    *  heatr.80   
c     *    qbar      tab1 record giving qbar versus e (1000 words max) *  heatr.81   
c     *                                                                *  heatr.82   
c     ******************************************************************  heatr.83   

THERMR
      subroutine thermr                                                  thermr.3    
c                                                                        thermr.4    
c     ****************************************************************** thermr.5    
c     *                                                                * thermr.6    
c     *  generate neutron scattering cross sections and point-to-point * thermr.7    
c     *  scattering kernels in the thermal range                       * thermr.8    
c     *                                                                * thermr.9    
c     *  add pointwise scattering cross sections and scattering        * thermr.10   
c     *  matrices to an existing pendf tape.  cross sections are       * thermr.11   
c     *  added to mf3 and matrices are written in mf6 (using a         * thermr.12   
c     *  modified format).  both using mtref for inelastic and         * thermr.13   
c     *  mtref+1 for elastic (if any).                                 * thermr.14   
c     *                                                                * thermr.15   
c     *  multiple scattering types (ie, h free and h in h2o) can be    * thermr.16   
c     *  written on one pendf tape by using different values of mtref  * thermr.17   
c     *  for each thermr run.  if data for one mtref is already on     * thermr.18   
c     *  the tape, it will be replaced with the new cross sections.    * thermr.19   
c     *  the energy grid for coherent scattering is determined         * thermr.20   
c     *  adaptively so as to represent the sharp bragg edges to        * thermr.21   
c     *  a specified tolerance using linear interpolation.  the        * thermr.22   
c     *  secondary energy grid for inelastic scattering is also deter- * thermr.23   
c     *  mined adaptively.  angular dependence is represented as       * thermr.24   
c     *  equally probable cosines.  the initial energy grid is wired in* thermr.25   
c     *  (see egrid in calcem).  a special projection interpolation    * thermr.26   
c     *  scheme is used in groupr to integrate this relatively         * thermr.27   
c     *  coarse grid.                                                  * thermr.28   
c     *                                                                * thermr.29   
c     *  current capabilities...                                       * thermr.30   
c     *     1.)  compute free-gas scattering matrices and normalize    * thermr.31   
c     *          to the elastic cross section on the old pendf tape.   * thermr.32   
c     *     2.)  compute incoherent matrices from read-in              * thermr.33   
c     *          s(alpha,beta) data.                                   * thermr.34   
c     *     3.)  compute coherent scattering from hexagonal lattices.  * thermr.35   
c     *     4.)  compute incoherent elastic scattering.                * thermr.36   
c     *                                                                * thermr.37   
c     *  for endf 3 to 5 formats, the constants used for coherent      * thermr.38   
c     *  elastic, incoherent elastic, and short-collision-time calcu-  * thermr.39   
c     *  lations are obtained from internal data statements based on   * thermr.40   
c     *  the original general atomic report on the evaluations         * thermr.41   
c     *  (ga-8774 revised, endf-269, july 1978).                       * thermr.42   
c     *                                                                * thermr.43   
c     *  for endf6 format libraries, these constants are included      * thermr.44   
c     *  in the format.                                                * thermr.45   
c     *                                                                * thermr.46   
c     *---input specifications (free format)---------------------------* thermr.47   
c     *                                                                * thermr.48   
c     *  card 1                                                        * thermr.49   
c     *     nendf      endf/b tape for mf7 data                        * thermr.50   
c     *     nin        old pendf tape                                  * thermr.51   
c     *     nout       new pendf tape                                  * thermr.52   
c     *  card 2                                                        * thermr.53   
c     *     matde      material desired on endf tape                   * thermr.54   
c     *     matdp      material desired on pendf tape                  * thermr.55   
c     *     nbin       number of equi-probable angles                  * thermr.56   
c     *     ntemp      number of temperatures                          * thermr.57   
c     *     iinc       inelastic options                               * thermr.58   
c     *                   0     none                                   * thermr.59   
c     *                   1     compute as free gas                    * thermr.60   
c     *                   2     reserved                               * thermr.61   
c     *                   3     reserved                               * thermr.62   
c     *                   4     read s(a,b) and compute matrix         * thermr.63   
c     *     icoh       elastic options                                 * thermr.64   
c     *                   0     none                                   * thermr.65   
c     *                   1     compute using ENDF6 input tape data    *  up284.5    
c     *                   --------or for pre-ENDF6 input set icoh =    *  up284.6    
c     *                   1     graphite                               * thermr.66   
c     *                   2     beryllium                              * thermr.67   
c     *                   3     beryllium oxide                        * thermr.68   
c     *                  11     polyethylene                           * thermr.69   
c     *                  12     h(zrh)                                 * thermr.70   
c     *                  13     zr(zrh)                                * thermr.71   
c     *     natom      number of principal atoms                       * thermr.72   
c     *     mtref      mt for inelastic reaction (221-250 only)        *  up266.6    
c     *     iprint     print option (0=minimum, 1=maximum,             * thermr.74   
c     *                2=max. normal + intermediate results)           * thermr.75   
c     *                (default=0)                                     * thermr.76   
c     *  card 3                                                        * thermr.77   
c     *     tempr      temperatures (kelvin)                           * thermr.78   
c     *  card 4                                                        * thermr.79   
c     *     tol        tolerance                                       * thermr.80   
c     *     emax       maximum energy for thermal treatment            * thermr.81   
c     *                (for temperatures greater than 3000,            * thermr.82   
c     *                emax and the energy grid are scaled by          * thermr.83   
c     *                temp/300.  free gas only.)                      * thermr.84   
c     *                                                                * thermr.85   
c     *       nendf can be endf-6 format (e.g., from leapr) while      * thermr.86   
c     *       nin and nout are endf-4 or 5 format, if desired.         * thermr.87   
c     *                                                                * thermr.88   
c     ****************************************************************** thermr.89   

GROUPR
      subroutine groupr                                                  groupr.3    
c                                                                        groupr.4    
c     ****************************************************************** groupr.5    
c     *                                                                * groupr.6    
c     * compute self-shielded group-averaged cross sections            * groupr.7    
c     *                                                                * groupr.8    
c     * produces self-shielded cross sections, neutron scattering      * groupr.9    
c     * matrices, and photon production matrices.  scattering and      * groupr.10   
c     * photon matrices may be self-shielded if desired (see init).    * groupr.11   
c     * bondarenko weighting is normally used.   optionally, the flux  * groupr.12   
c     * can be computed for an infinite mixture of heavy absorber      * groupr.13   
c     * and light moderator.  delayed neutron data and thermal         * groupr.14   
c     * scattering matrices are handled specially.                     * groupr.15   
c     *                                                                * groupr.16   
c     * the integration over initial energy is handled in the same     * groupr.17   
c     * way for all reaction types by using the integrand              * groupr.18   
c     *                   feed*xsec*flux                   .           * groupr.19   
c     * feed is the source into final energy group gprime and          * groupr.20   
c     * legendre order l from initial energy e (see getff).  for       * groupr.21   
c     * vectors, the feed is 1. or a yield (nubar, mubar).  for two    * groupr.22   
c     * body scattering, a center-of-mass gaussian integration is used * groupr.23   
c     * to obtain accurate results even for small legendre components  * groupr.24   
c     * of the group-to-group scattering.  additional initial energy   * groupr.25   
c     * quadrature points are added to integrate the known polynomial  * groupr.26   
c     * order of this feed function.  feed for tabulated continuum     * groupr.27   
c     * reactions is computed exactly on the endf/b grid points and    * groupr.28   
c     * then interpolated at e.  a special projection interpolation    * groupr.29   
c     * scheme is used for thermal matrices (see getaed).  the feed    * groupr.30   
c     * for analytic continuum reactions is exact.                     * groupr.31   
c     *                                                                * groupr.32   
c     *---input specifications (free format)---------------------------* groupr.33   
c     *                                                                * groupr.34   
c     * card1                                                          * groupr.35   
c     *    nendf   unit for endf/b tape                                * groupr.36   
c     *    npend   unit for pendf tape                                 * groupr.37   
c     *    ngout1  unit for input gout tape (default=0)                * groupr.38   
c     *    ngout2  unit for output gout tape (default=0)               * groupr.39   
c     * card2                                                          * groupr.40   
c     *    matb    material to be processed                            * groupr.41   
c     *             if ngout=0, matb<0 is an option to automatically   * groupr.42   
c     *              process all the mats on the endf input tape.      * groupr.43   
c     *             otherwise, matb<0 is a flag to add mts to and/or   * groupr.44   
c     *              replace individual mts on gout1.                  * groupr.45   
c     *    ign     neutron group structure option                      * groupr.46   
c     *    igg     gamma group structure option                        * groupr.47   
c     *    iwt     weight function option                              * groupr.48   
c     *    lord    legendre order                                      * groupr.49   
c     *    ntemp   number of temperatures                              * groupr.50   
c     *    nsigz   number of sigma zeroes                              * groupr.51   
c     *    iprint  long print option (0/1=minimum/maximum)             * groupr.52   
c     *            (default=1)                                         * groupr.53   
c     * card3                                                          * groupr.54   
c     *    title   run label (up to 80 characters delimited by *,      * groupr.55   
c     *            ended with /)  (default=blank)                      * groupr.56   
c     * card4                                                          * groupr.57   
c     *    temp    temperatures in kelvin                              * groupr.58   
c     * card5                                                          * groupr.59   
c     *    sigz    sigma zero values (including infinity)              * groupr.60   
c     *                                                                * groupr.61   
c     *          if ign=1, read neutron group structure (6a and 6b)    * groupr.62   
c     * card6a                                                         * groupr.63   
c     *    ngn     number of groups                                    * groupr.64   
c     * card6b                                                         * groupr.65   
c     *    egn     ngn+1 group breaks (ev)                             * groupr.66   
c     *                                                                * groupr.67   
c     *          if igg=1, read gamma group structure (7a and 7b)      * groupr.68   
c     * card7a                                                         * groupr.69   
c     *    ngg     number of groups                                    * groupr.70   
c     * card7b                                                         * groupr.71   
c     *    egg     ngg+1 group breaks (ev)                             * groupr.72   
c     *                                                                * groupr.73   
c     *          weight function options (8a,8b,8c,8d)                 * groupr.74   
c     * card8a     flux calculator parameters (iwt.lt.0 only)          * groupr.75   
c     *    ehi     break between computed flux and bondarenko flux     * groupr.76   
c     *                (must be in resolved range)                     * groupr.77   
c     *    sigpot  estimate of potential scattering cross section      * groupr.78   
c     *    nflmax  maximum number of computed flux points              * groupr.79   
c     *    ninwt   tape unit for new flux parameters (default=0)       * groupr.80   
c     *            note: weighting flux file is always written binary  *  up105.72   
c     *    jsigz   index of reference sigma zero in sigz array         * groupr.81   
c     *            (default=0)                                         * groupr.82   
c     *    alpha2   alpha for admixed moderator (def=o=none)           * groupr.83   
c     *    sam      admixed moderator xsec in barns per absorber       * groupr.84   
c     *             atom (def=0=none)                                  * groupr.85   
c     *    beta     heterogeniety parameter (def=0=none)               * groupr.86   
c     *    alpha3   alpha for external moderator (def=0=none)          * groupr.87   
c     *    gamma    fraction of admixed moderator cross section in     * groupr.88   
c     *              external moderator cross section (def=0)          * groupr.89   
c     * card8b     tabulated (iwt=1 or -1 only)                        * groupr.90   
c     *    wght    read weight function as tab1 record.                * groupr.91   
c     *            end with a /.                                       * groupr.92   
c     * card8c     analytic flux parameters (iwt=4 or -4 only)         * groupr.93   
c     *    eb      thermal break (ev)                                  * groupr.94   
c     *    tb      thermal temperature (ev)                            * groupr.95   
c     *    ec      fission break (ev)                                  * groupr.96   
c     *    tc      fission temperature (ev)                            * groupr.97   
c     * card8d     input resonance flux (iwt=0 only)                   * groupr.98   
c     *    ninwt   tape unit for flux parameters (binary)              *  up105.74   
c     *                                                                * groupr.100  
c     * card9                                                          * groupr.101  
c     *    mfd     file to be processed                                * groupr.102  
c     *    mtd     section to be processed                             * groupr.103  
c     *    mtname  description of section to be processed              * groupr.104  
c     *          repeat for all reactions desired                      * groupr.105  
c     *          mfd=0/ terminates this temperature/material.          * groupr.106  
c     * card10                                                         * groupr.107  
c     *    matd    next mat number to be processed                     * groupr.108  
c     *            matd=0/ terminates groupr run.                      * groupr.109  
c     *                                                                * groupr.110  
c     *---options for input variables----------------------------------* groupr.111  
c     *                                                                * groupr.112  
c     *     ign          meaning                                       * groupr.113  
c     *     ---          -------                                       * groupr.114  
c     *      1           arbitrary structure (read in)                 * groupr.115  
c     *      2           csewg 239-group structure                     * groupr.116  
c     *      3           lanl 30-group structure                       * groupr.117  
c     *      4           anl 27-group structure                        * groupr.118  
c     *      5           rrd 50-group structure                        * groupr.119  
c     *      6           gam-i 68-group structure                      * groupr.120  
c     *      7           gam-ii 100-group structure                    * groupr.121  
c     *      8           laser-thermos 35-group structure              * groupr.122  
c     *      9           epri-cpm 69-group structure                   * groupr.123  
c     *     10           lanl 187-group structure                      * groupr.124  
c     *     11           lanl 70-group structure                       * groupr.125  
c     *     12           sand-ii 620-group structure                   * groupr.126  
c     *     13           lanl 80-group structure                       * groupr.127  
c     *     14           eurlib 100-group structure                    * groupr.128  
c     *     15           sand-iia 640-group structure                  * groupr.129  
c     *     16           vitamin-e 174-group structure                 * groupr.130  
c     *     17           vitamin-j 175-group structure                 * groupr.131  
c     *     18           xmas nea-lanl                                    up107.9    
c     *     all new additional group structure with 7 significant         up107.10   
c     *     decimal digits compatible with calendf                        up107.11   
c     *     19           ecco  33-group structure                         up107.12   
c     *     20           ecco 1968-group structure                        up107.13   
c     *     21           tripoli 315-group structure                      up107.14   
c     *     22           xmas lwpc 172-group structure                    up107.15   
c     *     23           vit-j lwpc 175-group structure                   up107.16   
c     *                                                                * groupr.132  
c     *     igg          meaning                                       * groupr.133  
c     *     ---          -------                                       * groupr.134  
c     *      0           none                                          * groupr.135  
c     *      1           arbitrary structure (read in)                 * groupr.136  
c     *      2           csewg 94-group structure                      * groupr.137  
c     *      3           lanl 12-group structure                       * groupr.138  
c     *      4           steiner 21-group gamma-ray structure          * groupr.139  
c     *      5           straker 22-group structure                    * groupr.140  
c     *      6           lanl 48-group structure                       * groupr.141  
c     *      7           lanl 24-group structure                       * groupr.142  
c     *      8           vitamin-c 36-group structure                  * groupr.143  
c     *      9           vitamin-e 38-group structure                  * groupr.144  
c     *     10           vitamin-j 42-group structure                  * groupr.145  
c     *                                                                * groupr.146  
c     *     iwt          meaning                                       * groupr.147  
c     *     ---          -------                                       * groupr.148  
c     *      1           read in smooth weight function                * groupr.149  
c     *      2           constant                                      * groupr.150  
c     *      3           1/e                                           * groupr.151  
c     *      4           1/e + fission spectrum + thermal maxwellian   * groupr.152  
c     *      5           epri-cell lwr                                 * groupr.153  
c     *      6           (thermal) -- (1/e) -- (fission + fusion)      * groupr.154  
c     *      7           same with t-dep thermal part                  * groupr.155  
c     *      8           thermal--1/e--fast reactor--fission + fusion  * groupr.156  
c     *      9           claw weight function                          * groupr.157  
c     *     10           claw with t-dependent thermal part            * groupr.158  
c     *     11           vitamin-e weight function (ornl-5505)         * groupr.159  
c     *     12           vit-e with t-dep thermal part                 * groupr.160  
c     *     -n           compute flux with weight n                    * groupr.161  
c     *      0           read in resonance flux from ninwt             * groupr.162  
c     *                                                                * groupr.163  
c     *     mfd          meaning                                       * groupr.164  
c     *     ---          -------                                       * groupr.165  
c     *      3           cross section or yield vector                 * groupr.166  
c     *      5           fission chi by short-cut method               * groupr.167  
c     *      6           neutron-neutron matrix (mf4/5)                * groupr.168  
c     *      8           neutron-neutron matrix (mf6)                  * groupr.169  
c     *     12           photon prod. xsec (photon yields given, mf12) * groupr.170  
c     *     13           photon prod. xsec (photon xsecs given, mf13)  * groupr.171  
c     *     16           neutron-gamma matrix (photon yields given)    * groupr.172  
c     *     17           neutron-gamma matrix (photon xsecs given)     * groupr.173  
c     *     18           neutron-gamma matrix (mf6)                    * groupr.174  
c     *         note: if necessary, mfd=13 will automatically change   * groupr.175  
c     *         to 12 and mfd=16 will automatically change to 17 or 18.* groupr.176  
c     *     21           proton production matrix (mf6)                * groupr.177  
c     *     22           deuteron production (mf6)                     * groupr.178  
c     *     23           triton production (mf6)                       * groupr.179  
c     *     24           he-3 production (mf6)                         * groupr.180  
c     *     25           alpha production (mf6)                        * groupr.181  
c     *     26           residual nucleus (a>4) production (mf6)       * groupr.182  
c     *     31           proton production matrix (mf4)                * groupr.183  
c     *     32           deuteron production (mf4)                     * groupr.184  
c     *     33           triton production (mf4)                       * groupr.185  
c     *     34           he-3 production (mf4)                         * groupr.186  
c     *     35           alpha production (mf4)                        * groupr.187  
c     *     36           residual nucleus (a>4) production (mf4)       * groupr.188  
c     *          note: if necessary, mfd=21-26 will                    * groupr.189  
c     *          automatically change to 31-36.                        * groupr.190  
c     *    1zzzaaam       nuclide production for zzzaaam               * groupr.191  
c     *                     subsection from file 3                     * groupr.192  
c     *    2zzzaaam       nuclide production for zzzaaam               * groupr.193  
c     *                     subsection from file 6                     * groupr.194  
c     *    3zzzaaam       nuclide production for zzzaaam               * groupr.195  
c     *                     subsection from file 9                     * groupr.196  
c     *    4zzzaaam       nuclide production for zzzaaam               * groupr.197  
c     *                     subsection from file 10                    * groupr.198  
c     *                                                                * groupr.199  
c     *     mtd          meaning                                       * groupr.200  
c     *     ---          -------                                       * groupr.201  
c     *     -n           process all mt numbers from the previous      * groupr.202  
c     *                          entry to n inclusive                  * groupr.203  
c     *     221-250      reserved for thermal scattering               * groupr.204  
c     *     258          average lethargy                              * groupr.205  
c     *     259          average inverse velocity (m/sec)              * groupr.206  
c     *                                                                * groupr.207  
c     *     automatic reaction processing options                      * groupr.208  
c     *     -------------------------------------                      * groupr.209  
c     *        3/        do all reactions in file3 on input pendf      * groupr.210  
c     *        6/        do all matrix reactions in endf dictionary    * groupr.211  
c     *       10/        do all isotope productions using mf8          * groupr.212  
c     *       13/        do all photon production cross sections       * groupr.213  
c     *       16/        do all photon production matrices             * groupr.214  
c     *       21/        do all proton production matrices             * groupr.215  
c     *       22/        do all deuteron production matrices           * groupr.216  
c     *       23/        do all triton production matrices             * groupr.217  
c     *       24/        do all he-3 production matrices               * groupr.218  
c     *       25/        do all alpha production matrices              * groupr.219  
c     *       26/        do all a>4 production matrices                * groupr.220  
c     *                                                                * groupr.221  
c     ****************************************************************** groupr.222  

GAMINR
      subroutine gaminr                                                  gaminr.3    
c                                                                        gaminr.4    
c     ****************************************************************** gaminr.5    
c     *                                                                * gaminr.6    
c     * compute multigroup photon cross sections                       * gaminr.7    
c     *                                                                * gaminr.8    
c     * produce multigroup photon interaction cross sections           * gaminr.9    
c     * and heating kerma factors using endf/b cross sections          * gaminr.10   
c     * and coherent and incoherent form factors.  initial energy      * gaminr.11   
c     * quadrature techiques are identical to those used in groupr.    * gaminr.12   
c     * secondary energy-angle quadrature is performed using gaussian  * gaminr.13   
c     * integration.                                                   * gaminr.14   
c     *                                                                * gaminr.15   
c     *---input specifications (free format)---------------------------* gaminr.16   
c     *                                                                * gaminr.17   
c     * card1                                                          * gaminr.18   
c     *    nendf   unit for endf/b tape                                * gaminr.19   
c     *    npend   unit for pendf tape                                 * gaminr.20   
c     *    ngam1   unit for input ngam tape (default=0)                * gaminr.21   
c     *    ngam2   unit for output ngam tape (default=0)               * gaminr.22   
c     * card2                                                          * gaminr.23   
c     *    matb    material to be processed                            * gaminr.24   
c     *            input materials in ascending order                  * gaminr.25   
c     *    igg     gamma group structure option                        * gaminr.26   
c     *    iwt     weight function option                              * gaminr.27   
c     *    lord    legendre order                                      * gaminr.28   
c     *    iprint  print option (0/1=minimum/maximum) (default=1)      * gaminr.29   
c     * card3                                                          * gaminr.30   
c     *    title   run label up to 80 characters (delimited by *,      * gaminr.31   
c     *            ended with /)                                       * gaminr.32   
c     * card4      (igg=1 only)                                        * gaminr.33   
c     *    ngg     number of groups                                    * gaminr.34   
c     *    egg     ngg+1 group bounds (ev)                             * gaminr.35   
c     * card5      (iwt=1 only)                                        * gaminr.36   
c     *    wght    weight function as tab1 record                      * gaminr.37   
c     * card6                                                          * gaminr.38   
c     *    mfd     file to be processed                                * gaminr.39   
c     *    mtd     section to be processed                             * gaminr.40   
c     *    mtname  description of section to be processed              * gaminr.41   
c     *            repeat for all reactions desired                    * gaminr.42   
c     *            mfd=0/ terminates this material                     * gaminr.43   
c     *            mfd=-1/ is a flag to process all sections present   * gaminr.44   
c     *            for this material  (termination is automatic)       * gaminr.45   
c     * card7                                                          * gaminr.46   
c     *    matd    next mat number to be processed                     * gaminr.47   
c     *            terminate gaminr run with matd=0.                   * gaminr.48   
c     *                                                                * gaminr.49   
c     *---options for input variables----------------------------------* gaminr.50   
c     *                                                                * gaminr.51   
c     *        igg     meaning                                         * gaminr.52   
c     *        ---     -------                                         * gaminr.53   
c     *         0      none                                            * gaminr.54   
c     *         1      arbitrary structure (read in)                   * gaminr.55   
c     *         2      csewg 94-group structure                        * gaminr.56   
c     *         3      lanl 12-group structure                         * gaminr.57   
c     *         4      steiner 21-group gamma-ray structure            * gaminr.58   
c     *         5      straker 22-group structure                      * gaminr.59   
c     *         6      lanl 48-group structure                         * gaminr.60   
c     *         7      lanl 24-group structure                         * gaminr.61   
c     *         8      vitamin-c 36-group structure                    * gaminr.62   
c     *         9      vitamin-e 38-group structure                    * gaminr.63   
c     *         10      vitamin-j 42-group structure                   * gaminr.64   
c     *                                                                * gaminr.65   
c     *        iwt     meaning                                         * gaminr.66   
c     *        ---     -------                                         * gaminr.67   
c     *         1      read in                                         * gaminr.68   
c     *         2      constant                                        * gaminr.69   
c     *         3      1/e + rolloffs                                  * gaminr.70   
c     *                                                                * gaminr.71   
c     ****************************************************************** gaminr.72   

ERRORJ / (ERRORR)
      subroutine errorr                                                  errorj.7    
c     ****************************************************************** errorj.8    
c     *                                                                * errorj.9    
c     * modifed errorr module based on the errorj code                 * errorj.10   
c     *                                                                * errorj.11   
c     * From errorr: egtflx, egtsig, grist, lumpmt, lumpxs, merge,     * errorj.12   
c     *              rdsig, stand                                      * errorj.13   
c     * From errorr with modifications:                                * errorj.14   
c     *              errorr, covcal, covout, egngpn, epanel, grpav,    * errorj.15   
c     *              rdgout, sigc, uniong, colaps, gridd, resprp,      * errorj.16   
c     *              rescon, egnwtf, wgtwtf                            * errorj.17   
c     * From reconr with modifications:                                * errorj.18   
c     *              ggrmat, ggmlbw, ssmlbw, ssslbw, ggunr1            * errorj.19   
c     * From errorj: resprx, Resprx_XXX, grpav4, alsigc, egtlgc,       * errorj.20   
c     *              musigc, matrixin, rdlgnd, fssigc, rdchi           * errorj.21   
c     *                                                                * errorj.22   
c     ****************************************************************** errorj.23   
c     *                                                                * errorj.24   
c     * Original changes for njoy99.258 by Skip Kahler (9/25+/2007):   *  up282.28   
c     *  - include ggrmat changes specified by Go Chiba in his "Bug-   * errorj.26   
c     *    fix for ERRORJ-2.3" memo, dated October 3, 2007 (his ggmlbw * errorj.27   
c     *    correction has already been made and noted below).          * errorj.28   
c     *  - change "implicit double precision" to "implicit real*8" to  * errorj.29   
c     *    match historical njoy coding practice.                      * errorj.30   
c     *  - change (or add) real number exponents from "e" to "d".      * errorj.31   
c     *  - make sure routines duplicated from other modules contain    * errorj.32   
c     *    the latest updates (through njoy99.257 currently).          * errorj.33   
c     *  - for consistency and future maintenance, replace assignments * errorj.34   
c     *    for pi and physical constants with values defined or        * errorj.35   
c     *    calculated from main program common blocks.                 * errorj.36   
c     *  - eliminate the "H" edit descriptor in format statements.     * errorj.37   
c     *  - changed "write(6,..." to "write(*,...".                     * errorj.38   
c     *  - fix typo, "cwave" -> "cwaven" in ggmlbw.                    * errorj.39   
c     *  - move "mprint=0" out of the if block in errorj so that this  * errorj.40   
c     *    variable is always properly initialized.                    * errorj.41   
c     *  - add "mxlru2" to ggunr1 call list for proper amu dimension   * errorj.42   
c     *    declaration (g95 compiler).                                 * errorj.43   
c     *  - change b(1),alp(1) to b(*),alp(*) in rdlgnd dimension       * errorj.44   
c     *    declaration (g95 compiler).                                 * errorj.45   
c     *  - restructure a number of multiple condition "if" tests to    * errorj.46   
c     *    avoid run-time (undefined variables or array bounds under/  * errorj.47   
c     *    overflow) errors from code compiled without optimization.   * errorj.48   
c     *  - change b(10) to b(*) in musigc and fssigc.                  * errorj.49   
c     *  - delete "return" that cannot be reached in ggunr1 (absoft    * errorj.50   
c     *    compiler).                                                  * errorj.51   
c     *  - miscellaneous text formatting changes to make the source    * errorj.52   
c     *    code flow more readable.                                    * errorj.53   
c     *                                                                * errorj.54   
c     ****************************************************************** errorj.55   
c     *                                                                * errorj.56   
c     * produce cross section covariances from error files in endf/b   * errorj.57   
c     * format                                                         * errorj.58   
c     *                                                                * errorj.59   
c     * first, the union energy grid of the users group structure      * errorj.60   
c     * and the endf covariance energies is determined.  the array     * errorj.61   
c     * of coefficients for derived cross sections is also constructed.* errorj.62   
c     * then multigroup cross sections are computed on the union       * errorj.63   
c     * grid (see grpav), or they are read from a multigroup cross     * errorj.64   
c     * section library and then collapsed to the union grid.  the     * errorj.65   
c     * methods of groupr are used for cross section averaging.  endf  * errorj.66   
c     * covariances and the group cross sections are then combined     * errorj.67   
c     * to get the basic covariance matrices (see covcal).  finally,   * errorj.68   
c     * the basic matrices are combined to get covariances for         * errorj.69   
c     * derived reactions, the matrices are collapsed to the user-s    * errorj.70   
c     * group structure, and the results are printed and/or written    * errorj.71   
c     * onto an output gendf tape for later use (see covout).          * errorj.72   
c     *                                                                * errorj.73   
c     *---input specifications (free format)---------------------------* errorj.74   
c     *                                                                * errorj.75   
c     *  card 1                                                        * errorj.76   
c     *    nendf   unit for endf/b tape                                * errorj.77   
c     *    npend   unit for pendf tape                                 * errorj.78   
c     *    ngout   unit for input group xsec (gendf) tape              * errorj.79   
c     *            (if zero, group xsecs will be calculated)           * errorj.80   
c     *            (if iread eq 2 or if mfcov eq 31, 35 or 40 (see     *  up324.27   
c     *            card 7), then ngout cannot be zero)                 *  up324.28   
c     *            (default=0)                                         * errorj.85   
c     *    nout    unit for output covariance tape (default=0)         * errorj.86   
c     *    nin     unit for input covariance tape (default=0)          * errorj.87   
c     *            (nin and nout must be both coded or both binary)    * errorj.88   
c     *    nstan   unit for ratio-to-standard tape (default=0)         * errorj.89   
c     *  card 2                                                        * errorj.90   
c     *    matd    material to be processed                            * errorj.91   
c     *    ign     neutron group option                                * errorj.92   
c     *            (ign definition same as groupr, except ign=19,      * errorj.93   
c     *            which means read in an energy grid, as in ign=1,    * errorj.94   
c     *            and supplement this with the endf covariance grid   * errorj.95   
c     *            within the range of the user-specified energies)    * errorj.96   
c     *            (default=1)                                         * errorj.97   
c     *    iwt     weight function option (default=6)                  * errorj.98   
c     *    iprint  print option (0/1=minimum/maximum) (default=1)      * errorj.99   
c     *    irelco  covariance form (0/1=absolute/relative) (default=1) * errorj.100  
c     *            (if mfcov=34, irelco must be 1)                     * errorj.101  
c     *  card 3    (omit if ngout.ne.0)                                * errorj.102  
c     *    mprint  print option for group averaging (0=min., 1=max.)   * errorj.103  
c     *    tempin  temperature (default=300)                           * errorj.104  
c     *                                                                * errorj.105  
c     *---for endf/b version 4 (iverf=4) only--------------------------* errorj.106  
c     *                                                                * errorj.107  
c     *  card 4                                                        * errorj.108  
c     *    nek     number of derived xsec energy ranges                * errorj.109  
c     *            (if zero, all xsecs are independent)                * errorj.110  
c     *  card 5    (omit if nek=0)                                     * errorj.111  
c     *    ek      nek+1 derived xsec energy bounds                    * errorj.112  
c     *  card 6    (omit if nek=0)                                     * errorj.113  
c     *    akxy    derived cross section coefficients, one row/line    * errorj.114  
c     *                                                                * errorj.115  
c     *---for endf/b version 5 or 6 (iverf=5 or 6) only----------------* errorj.116  
c     *                                                                * errorj.117  
c     *  card 7                                                        * errorj.118  
c     *    iread   0/1/2=program calculated mts/input mts and eks/     * errorj.119  
c     *            calculated mts plus extra mat1-mt1 pairs from input * errorj.120  
c     *            (default=0)                                         * errorj.121  
c     *    mfcov   endf covariance file (31, 33, 34, 35 or 40) to be   *  up324.30   
c     *            processed (default=33).                             * errorj.123  
c     *            note--contribution to group cross section           * errorj.124  
c     *            covariances from resonance-parameter uncertainties  * errorj.125  
c     *            (mf=32) is included when mfcov=33 is specified.     * errorj.126  
c     *            (mf=-33) high speed Calc. for test case             * errorj.127  
c     *            (mf=333) high speed Calc. for test case(faster)     * errorj.128  
c     *    irespr  processing option of resonance parameter covariance * errorj.129  
c     *            (mf=32) (default=1)                                 * errorj.130  
c     *            0 = area sensitivity method                         * errorj.131  
c     *            1 = 1% sensitivity method                           * errorj.132  
c     *    legord  legendre order calculating covariance (default=1)   * errorj.133  
c     *            (if mfcov is not 34, legord is ignored)             * errorj.134  
c     *    ifissp  subsection of the fission spectrum covariance       *  up282.30   
c     *            matrix to process (default=-1 which means process   *  up282.31   
c     *            the subsection that includes efmean).  The value    *  up282.32   
c     *            for ifissp that appears in njoy's standard output   *  up282.33   
c     *            will equal the subsection containing efmean.        *  up282.34   
c     *            (if mfcov is not 35, ifissp is ignored)             *  up282.35   
c     *    efmean  incident neutron energy (eV).  Process the covar-   *  up282.36   
c     *            iance matrix subsection whose energy interval in-   *  up282.37   
c     *            cludes efmean.  if ifissp=-1 and efmean is not      *  up282.38   
c     *            specified, set efmean=2.d6.  But if there is only   *  up282.39   
c     *            one subsection, process it and if the input efmean  *  up282.40   
c     *            was not within this subsection's energy range then  *  up282.41   
c     *            redefine efmean to equal the average energy for     *  up282.42   
c     *            this subsection.                                    *  up282.43   
c     *            (if mfcov is not 35, efmean is ignored)             *  up282.44   
c     *    dap     user specified scattering radius uncertainty, given *  up329.14   
c     *            as a fraction (i.e., dap=0.1 means 10% uncertainty  *  up329.15   
c     *            in the scattering radius).  The default value is    *  up329.16   
c     *            zero.  This variable is only defined for mfcov=33   *  up329.17   
c     *            and if non-zero will be used in lieu of any data    *  up329.18   
c     *            that might have been read from the nendf tape.      *  up329.19   
c     *                                                                * errorj.140  
c     *  following cards only if iread eq 1                            * errorj.141  
c     *  card 8                                                        * errorj.142  
c     *    nmt     no. mts to be processed                             * errorj.143  
c     *    nek     no. derived cross section energy ranges             * errorj.144  
c     *            (if zero, all xsecs are independent)                * errorj.145  
c     *  card 8a                                                       * errorj.146  
c     *    mts     nmt mts                                             * errorj.147  
c     *  card 8b   (omit if nek=0)                                     * errorj.148  
c     *    ek      nek+1 derived cross section energy bounds           * errorj.149  
c     *  card 9    (omit if nek=0)                                     * errorj.150  
c     *    akxy    derived cross section coefficients, one row/line    * errorj.151  
c     *                                                                * errorj.152  
c     *  following card only if iread eq 2                             * errorj.153  
c     *  card 10                                                       * errorj.154  
c     *    mat1    cross-material reaction to be added to              * errorj.155  
c     *    mt1         covariance reaction list.                       * errorj.156  
c     *            repeat for all mat1-mt1 pairs desired               * errorj.157  
c     *            terminate with mat1=0.                              * errorj.158  
c     *                                                                * errorj.159  
c     *  following card only if nstan ne 0                             * errorj.160  
c     *  card 11                                                       * errorj.161  
c     *    matb    standards reaction referenced                       * errorj.162  
c     *    mtb         in matd.                                        * errorj.163  
c     *    matc    standards reaction to be                            * errorj.164  
c     *    mtc         used instead.                                   * errorj.165  
c     *            repeat for all standard reactions to be redefined.  * errorj.166  
c     *            terminate with matb=0.                              * errorj.167  
c     *  note.  if matb(1) and mtb(1) are negative, then matc(1) and   * errorj.168  
c     *    mtc(1) identify a third reaction, correlated with matd thru * errorj.169  
c     *    the use of the same standard.  covariances of all reactions * errorj.170  
c     *    in matd (which reference the standard) with the reaction    * errorj.171  
c     *    matc(1)-mtc(1) will be produced.  the standard reaction     * errorj.172  
c     *    must be identified on card 10 and repeated as the negative  * errorj.173  
c     *    entries on card 11.  the group xsec tape ngout must include * errorj.174  
c     *    all covariance reactions in matd, plus matc(1)-mtc(1).      * errorj.175  
c     *----------------------------------------------------------------* errorj.176  
c     *                                                                * errorj.177  
c     *  card 12a (for ign eq 1 or ign eq 19)                          * errorj.178  
c     *    ngn     number of groups                                    * errorj.179  
c     *            (if negative, group bounds is decending order)      * errorj.180  
c     *  card 12b                                                      * errorj.181  
c     *    egn     ngn+1 group bounds (ev)                             * errorj.182  
c     *  card 13a  tabulated (iwt=1 only)                              * errorj.183  
c     *    wght    weight function as a tab1 record                    * errorj.184  
c     *  card 13b  analytic flux parameters (iwt=4 only)               * errorj.185  
c     *    eb      thermal break (ev)                                  * errorj.186  
c     *    tb      thermal temperature (ev)                            * errorj.187  
c     *    ec      fission break (ev)                                  * errorj.188  
c     *    tc      fission temperature (ev)                            * errorj.189  
c     *                                                                * errorj.190  
c     *---options for input variables----------------------------------* errorj.191  
c     *                                                                * errorj.192  
c     *     ign          meaning                                       * errorj.193  
c     *     ---          -------                                       * errorj.194  
c     *      1           arbitrary structure (read in)                 * errorj.195  
c     *      2           csewg 239-group structure                     * errorj.196  
c     *      3           lanl 30-group structure                       * errorj.197  
c     *      4           anl 27-group structure                        * errorj.198  
c     *      5           rrd 50-group structure                        * errorj.199  
c     *      6           gam-i 68-group structure                      * errorj.200  
c     *      7           gam-ii 100-group structure                    * errorj.201  
c     *      8           laser-thermos 35-group structure              * errorj.202  
c     *      9           epri-cpm 69-group structure                   * errorj.203  
c     *     10           lanl 187-group structure                      * errorj.204  
c     *     11           lanl 70-group structure                       * errorj.205  
c     *     12           sand-ii 620-group structure                   * errorj.206  
c     *     13           lanl 80-group structure                       * errorj.207  
c     *     14           eurlib 100-group structure                    * errorj.208  
c     *     15           sand-iia 640-group structure                  * errorj.209  
c     *     16           vitamin-e 174-group structure                 * errorj.210  
c     *     17           vitamin-j 175-group structure                 * errorj.211  
c     *     18           xmas 172-group structure                      * errorj.212  
c     *     19          read in, supplemented with endf covariance grid* errorj.213  
c     *                                                                * errorj.214  
c     *     iwt          meaning                                       * errorj.215  
c     *     ---          -------                                       * errorj.216  
c     *      1           read in smooth weight function                * errorj.217  
c     *      2           constant                                      * errorj.218  
c     *      3           1/e                                           * errorj.219  
c     *      4           1/e + fission spectrum + thermal maxwellian   * errorj.220  
c     *      5           epri-cell lwr                                 * errorj.221  
c     *      6           (thermal) -- (1/e) -- (fission + fusion)      * errorj.222  
c     *      7           same with t-dep thermal part                  * errorj.223  
c     *      8           thermal--1/e--fast reactor--fission + fusion  * errorj.224  
c     *      9           claw weight function                          * errorj.225  
c     *     10           claw with t-dependent thermal part            * errorj.226  
c     *     11           vitamin-e weight function (ornl-5505)         * errorj.227  
c     *     12           vit-e with t-dep thermal part                 * errorj.228  
c     *                                                                * errorj.229  
c     ****************************************************************** errorj.230  

COVR
      subroutine covr                                                      covr.3    
c                                                                          covr.4    
c     ******************************************************************   covr.5    
c     *                                                                *   covr.6    
c     * plot covariance data from errorr or make a condensed library.  *   covr.7    
c     *                                                                *   covr.8    
c     * in the plot option, covr plots a matrix of correlation         *   covr.9    
c     * coefficients and an associated pair of standard deviation      *   covr.10   
c     * vectors,i.e.,a covariance matrix.  the correlation             *   covr.11   
c     * matrix is plotted as a shaded contour plot and the vectors     *   covr.12   
c     * are plotted as semi-log plots,one rotated by 90 degrees.       *   covr.13   
c     * the log energy grids for the vector plots are identical        *   covr.14   
c     * to the grids for the matrix plot.  this version plots          *   covr.15   
c     * through viewr.                                                 *   covr.16   
c     *                                                                *   covr.17   
c     * in the library option, covr produces a condensed bcd           *   covr.18   
c     * covariance library in the boxer format.  this format is        *   covr.19   
c     * efficient for matrices of simple blocks.                       *   covr.20   
c     *                                                                *   covr.21   
c     *---input specifications (free format)---------------------------*   covr.22   
c     *                                                                *   covr.23   
c     *  card 1                                                        *   covr.24   
c     *     nin            input tape unit                             *   covr.25   
c     *     nout           output tape unit                            *   covr.26   
c     *                    (default=0=none)                            *   covr.27   
c     *     nplot          viewr output unit                           *   covr.28   
c     *                    (default=0=none)                            *   covr.29   
c     *                                                                *   covr.30   
c     *   ---cards 2, 2', 2a, and 3a for nout.le.0 only (plot option)  *  up366.12   
c     *                                                                *   covr.32   
c     *  card 2                                                        *   covr.33   
c     *     icolor          select color or monochrome style           *   covr.34   
c     *                       0=monochrome (uses cross hatching)       *   covr.35   
c     *                       1=color background and contours          *   covr.36   
c     *                       2=color background and contours, plus    *  up366.14   
c     *                         card 2' follows.                       *  up366.15   
c     *                       (default=0)                              *   covr.37   
c     *                                                                *  up366.17   
c     *  card 2' (only when icolor=2)                                  *  up366.18   
c     *     nlev,(tlev(i),i=1,nlev)                                    *  up366.19   
c     *                    defines the number of correlation matrix    *  up366.20   
c     *                    intervals and their boundaries.  Zero is    *  up366.21   
c     *                    assumed as the lower limit of the first     *  up366.22   
c     *                    boundary, but the user must specify unity   *  up366.23   
c     *                    as the upper limit of the last boundary.    *  up366.24   
c     *                    nlev is a positive integer .le. 9.          *  up366.25   
c     *                    default values (used when icolor=1) are:    *  up366.26   
c     *                      6,0.001,0.1,0.2,0.3,0.6,1.0               *  up366.27   
c     *  card 2a                                                       *   covr.38   
c     *     epmin          lowest energy of interest (default=0.)      *   covr.39   
c     *  card 3a                                                       *   covr.40   
c     *     irelco         type of covariances present on nin          *   covr.41   
c     *                    0/1=absolute/relative covariances           *   covr.42   
c     *                    (default=1)                                 *   covr.43   
c     *     ncase          no. cases to be run (maximum=60)            *  up160.62   
c     *                    (default=1)                                 *   covr.45   
c     *     noleg          plot legend option                          *   covr.46   
c     *                    -1/0/1=legend for first subcase only/       *   covr.47   
c     *                    legend for all plots/no legends             *   covr.48   
c     *                    (default=0)                                 *   covr.49   
c     *     nstart         sequential figure number                    *   covr.50   
c     *                    0/n=not needed/first figure is figure n.    *   covr.51   
c     *                    (default=1)                                 *   covr.52   
c     *     ndiv           no. of subdivisions of each of the          *   covr.53   
c     *                    gray shades (default=1)                     *   covr.54   
c     *                                                                *   covr.55   
c     *   ---cards 2b, 3b, and 3c for nout gt 0 (library option) only--*   covr.56   
c     *                                                                *   covr.57   
c     *  card 2b                                                       *   covr.58   
c     *     matype         output library matrix option                *   covr.59   
c     *                    3/4=covariances/correlations                *   covr.60   
c     *                    (default=3)                                 *   covr.61   
c     *     ncase          no. cases to be run (maximum=60)            *  up160.64   
c     *                    (default=1)                                 *   covr.63   
c     *  card 3b                                                       *   covr.64   
c     *     hlibid         up to 6 characters for identification       *   covr.65   
c     *  card 3c                                                       *   covr.66   
c     *     hdescr         up to 21 characters of descriptive          *   covr.67   
c     *                    information                                 *   covr.68   
c     *                                                                *   covr.69   
c     *   ---cards 4 for both options---                               *   covr.70   
c     *                                                                *   covr.71   
c     *  card 4                                                        *   covr.72   
c     *     mat            desired mat number                          *   covr.73   
c     *     mt             desired mt number                           *   covr.74   
c     *     mat1           desired mat1 number                         *   covr.75   
c     *     mt1            desired mt1 number                          *   covr.76   
c     *                    (default for mt, mat1 and mt1 are 0,0,0     *   covr.77   
c     *                    meaning process all mts for this mat        *   covr.78   
c     *                    with mat1=mat)                              *   covr.79   
c     *                    (neg. values for mt, mat1, and mt1 mean     *   covr.80   
c     *                    process all mts for this mat, except for    *   covr.81   
c     *                    the mt-numbers -mt, -mat1, and -mt1.  in    *   covr.82   
c     *                    general, -n will strip both mt=1 and mt=n.  *   covr.83   
c     *                    -4 will strip mt=1, mt=3, and mt=4, and     *   covr.84   
c     *                    -62, for example, will strip mt=1, mt=62,   *   covr.85   
c     *                    mt=63, ... up to and incl. mt=90.)          *   covr.86   
c     *          repeat card 4 ncase times                             *   covr.87   
c     *                                                                *   covr.88   
c     * note---if more than one material appears on the input tape,    *   covr.89   
c     * the mat numbers must be in ascending order.                    *   covr.90   
c     *                                                                *   covr.91   
c     ******************************************************************   covr.92   

MODER
      subroutine moder                                                    moder.3    
c                                                                         moder.4    
c     ******************************************************************  moder.5    
c     *                                                                *  moder.6    
c     *  change the mode of an endf/b tape.                            *  moder.7    
c     *                                                                *  moder.8    
c     *  also works for pendf, gendf and covariance tapes.             *  moder.9    
c     *  moder can also be used to select materials from an endf-type  *  moder.10   
c     *  tape, or to merge several materials into a new tape.          *  moder.11   
c     *                                                                *  moder.12   
c     *---input specifications (free format)---------------------------*  moder.13   
c     *                                                                *  moder.14   
c     * card 1       unit numbers                                      *  moder.15   
c     *      nin     input unit                                        *  moder.16   
c     *      nout    output unit                                       *  moder.17   
c     *                                                                *  moder.18   
c     *  a positive unit is coded (mode 3).                            *  moder.19   
c     *  a negative unit is blocked binary (njoy mode).                *  moder.20   
c     *                                                                *  moder.21   
c     *  note: abs(nin) ge 1 and le 19 is a flag to select various     *  moder.22   
c     *        materials from one or more input tapes, with or         *  moder.23   
c     *        without mode conversion.  the kind of data to be        *  moder.24   
c     *        processed is keyed to nin as follows:                   *  moder.25   
c     *             nin=1, for endf or pendf input and output,         *  moder.26   
c     *                 2, for gendf input and output,                 *  moder.27   
c     *                 3, for errorr-format input and output.         *  moder.28   
c     *                                                                *  moder.29   
c     *      cards 2 and 3 for abs (nin) ge 1 and le 19 only.          *  moder.30   
c     *                                                                *  moder.31   
c     * card 2                                                         *  moder.32   
c     *      tpid    tapeid for nout.  66 characters allowed           *  moder.33   
c     *              (delimited with *, ended with /)                  *  moder.34   
c     * card 3                                                         *  moder.35   
c     *      nin     input unit                                        *  moder.36   
c     *              terminate moder by setting nin=0                  *  moder.37   
c     *      matd    material on this tape to add to nout              *  moder.38   
c     ******************************************************************  moder.39   

DTFR
      subroutine dtfr                                                      dtfr.3    
c                                                                          dtfr.4    
c     ******************************************************************   dtfr.5    
c     *                                                                *   dtfr.6    
c     * convert output of groupr to dtf format.                        *   dtfr.7    
c     *                                                                *   dtfr.8    
c     * processes neutron and gamma production cross sections and      *   dtfr.9    
c     * matrices.  the neutron tables can have reduced table length.   *   dtfr.10   
c     * up-scatter is allowed.  the absorption reaction is computed    *   dtfr.11   
c     * from the total cross section and total scattering.  any edits  *   dtfr.12   
c     * can be produced which are either given in the endf/b file      *   dtfr.13   
c     * or are linear combinations of endf/b cross sections.  the      *   dtfr.14   
c     * fission nu*sigf and chi are computed from the fission matrices *   dtfr.15   
c     * for all partial fission reactions.  chi includes source        *   dtfr.16   
c     * weighting.  the pl tables for l.gt.0 contain the pl weighted   *   dtfr.17   
c     * total in the total position and the pl transport cross section *   dtfr.18   
c     * in the absorption position.  the gamma tables have gamma group *   dtfr.19   
c     * 1 in position 1, 2 in position 2, etc, with a table length     *   dtfr.20   
c     * equal to the number of gamma groups.                           *   dtfr.21   
c     *                                                                *   dtfr.22   
c     * plots can be prepared in viewr format.                         *   dtfr.23   
c     *                                                                *   dtfr.24   
c     *---input specifications (free format)---------------------------*   dtfr.25   
c     *                                                                *   dtfr.26   
c     * card 1       units                                             *   dtfr.27   
c     *    nin       input unit with data from groupr (binary).        *   dtfr.28   
c     *    nout      output unit containing dtf tables (coded).        *   dtfr.29   
c     *              (default=0=none)                                  *   dtfr.30   
c     *    npend     input unit with pendf tape for point plots.       *   dtfr.31   
c     *              (default=0=none)                                  *   dtfr.32   
c     *    nplot     output plot info for plotr module                 *   dtfr.33   
c     *              (default=0=none)                                  *   dtfr.34   
c     * card 2       options                                           *   dtfr.35   
c     *    iprint    print control (0 minimum, 1 maximum)              *   dtfr.36   
c     *    ifilm     film control (0/1/2=no/yes with 1 plot per frame/ *   dtfr.37   
c     *              yes with 4 plots per frame (default=0)            *   dtfr.38   
c     *    iedit     edit control (0/1=in table/separate) (default=0)  *   dtfr.39   
c     *                                                                *   dtfr.40   
c     *       cards 3 through 5 only for iedit=0                       *   dtfr.41   
c     *                                                                *   dtfr.42   
c     * card 3       neutron tables                                    *   dtfr.43   
c     *    nlmax     number of neutron tables desired.                 *   dtfr.44   
c     *    ng        number of neutron groups                          *   dtfr.45   
c     *    iptotl    position of total cross section                   *   dtfr.46   
c     *    ipingp    position of in-group scattering cross section.    *   dtfr.47   
c     *    itabl     neutron table length desired.                     *   dtfr.48   
c     *    ned       number of entries in edit table (default=0).      *   dtfr.49   
c     *    ntherm    number of thermal groups (default=0).             *   dtfr.50   
c     *  card 3a only for ntherm ne 0                                  *   dtfr.51   
c     * card 3a      thermal incoherent and coherent mts               *   dtfr.52   
c     *    mti       mt for thermal incoherent data                    *   dtfr.53   
c     *    mtc       mt for thermal coherent data (default=0)          *   dtfr.54   
c     *    nlc       no. coherent legendre orders (default=0)          *   dtfr.55   
c     * card 4       edit names                                        *   dtfr.56   
c     *       six character hollerith names for edits for as many      *   dtfr.57   
c     *       cards as needed.  there will be iptotl-3 names read.     *   dtfr.58   
c     *       each name is delimited with *.                           *   dtfr.59   
c     * card 5       edit specifications                               *   dtfr.60   
c     *       ned triplets of numbers on as many cards as needed.      *   dtfr.61   
c     *       positions can appear more than once.                     *   dtfr.62   
c     *       reaction types can appear more than once.                *   dtfr.63   
c     *    jpos      position of edit quantity.                        *   dtfr.64   
c     *    mt        endf/b reaction number.                           *   dtfr.65   
c     *    mult      multiplicity to be used when adding this mt.      *   dtfr.66   
c     *                                                                *   dtfr.67   
c     *       card 6 for iedit=1                                       *   dtfr.68   
c     *                                                                *   dtfr.69   
c     * card 6       claw-format tables                                *   dtfr.70   
c     *    nlmax     number of neutron tables (def=5)                  *   dtfr.71   
c     *    ng        number of neutron groups (def=30)                 *   dtfr.72   
c     *              (number of thermal groups is zero)                *   dtfr.73   
c     *                                                                *   dtfr.74   
c     * card 7       gamma ray tables                                  *   dtfr.75   
c     *    nptabl    number of gamma tables desired (default=0)        *   dtfr.76   
c     *    ngp       number of gamma groups (default=0)                *   dtfr.77   
c     * card 8       material description                              *   dtfr.78   
c     *       one card for each table set desired.                     *   dtfr.79   
c     *       empty card (/) terminates execution of dtfr.             *   dtfr.80   
c     *    hisnam    6-character isotope name                          *   dtfr.81   
c     *    mat       material number as in endf/b (default=0)          *   dtfr.82   
c     *    jsigz     index number of sigma-zero desired (default=1)    *   dtfr.83   
c     *    dtemp     temperature desired (default=300)                 *   dtfr.84   
c     *                                                                *   dtfr.85   
c     ******************************************************************   dtfr.86   

CCCCR
      subroutine ccccr                                                    ccccr.3    
c                                                                         ccccr.4    
c     ******************************************************************  ccccr.5    
c     *                                                                *  ccccr.6    
c     *  produce cccc-iv files from njoy intermediate cross section    *  ccccr.7    
c     *  library                                                       *  ccccr.8    
c     *                                                                *  ccccr.9    
c     *  working from a groupr output tape, this module produces       *  ccccr.10   
c     *  the following three standard interface files,                 *  ccccr.11   
c     *                                                                *  ccccr.12   
c     *           isotxs       brkoxs       dlayxs,                    *  ccccr.13   
c     *                                                                *  ccccr.14   
c     *  as specified by the committee for computer code coordination  *  ccccr.15   
c     *  (cccc), to facilitate the exchange of nuclear data for reactor*  ccccr.16   
c     *  calculations (reference 1).                                   *  ccccr.17   
c     *      in a given run, all three files can be produced using the *  ccccr.18   
c     *  same user-specified list of isotopes.  the code will ignore   *  ccccr.19   
c     *  isotopes which are not present on the groupr tape (and in the *  ccccr.20   
c     *  case of dlayxs, isotopes without delayed neutron data).       *  ccccr.21   
c     *      the isotxs coding allows for nsblk equal to one or ngroup.*  ccccr.22   
c     *  in addition, files with higher order matrices can be produced *  ccccr.23   
c     *  with a separate block for each l-order (ifopt=2) or with all  *  ccccr.24   
c     *  orders in one block (ifopt=1).  this flexibility accommodates *  ccccr.25   
c     *  large group structures.  fission vectors or fission           *  ccccr.26   
c     *  matrices can be produced.                                     *  ccccr.27   
c     *      in brkoxs, the potential scattering cross section for all *  ccccr.28   
c     *  energy groups is equal to the user-input value (xspo).        *  ccccr.29   
c     * the elastic removal f-factor is supplied as the sixth reaction.*  ccccr.30   
c     *                                                                *  ccccr.31   
c     *  1. r.d.odell. standard interface files and procedures         *  ccccr.32   
c     *     for reactor physics codes, version iv,                     *  ccccr.33   
c     *     lanl report la-6941-ms (sept.77)                           *  ccccr.34   
c     *                                                                *  ccccr.35   
c     *                                                                *  ccccr.36   
c     *---input specifications (free format)---------------------------*  ccccr.37   
c     *                                                                *  ccccr.38   
c     *-ccccr-                                                         *  ccccr.39   
c     * card 1 units                                                   *  ccccr.40   
c     *    nin      input unit for data from groupr                    *  ccccr.41   
c     *    nisot    output unit for isotxs (0 if isotxs not wanted)    *  ccccr.42   
c     *    nbrks    output unit for brkoxs (0 if brkoxs not wanted)    *  ccccr.43   
c     *    ndlay    output unit for dlayxs (0 if dlayxs not wanted)    *  ccccr.44   
c     * card 2 identification                                          *  ccccr.45   
c     *    lprint    print flag (0/1=not print/printed)                *  ccccr.46   
c     *    ivers     file version number (default=0)                   *  ccccr.47   
c     *    huse      user identification (12 characters)               *  ccccr.48   
c     *              delimited by *, ended by /.                       *  ccccr.49   
c     *              (default=blank)                                   *  ccccr.50   
c     * card 3                                                         *  ccccr.51   
c     *    hsetid    hollerith identification of set (12 characters)   *  ccccr.52   
c     *              delimited by *, ended by /.                       *  ccccr.53   
c     *              (default=blank)                                   *  ccccr.54   
c     * card 4 file control                                            *  ccccr.55   
c     *    ngroup    number of neutron energy groups                   *  ccccr.56   
c     *    nggrup    number of gamma energy groups                     *  ccccr.57   
c     *    niso      number of isotopes desire                         *  ccccr.58   
c     *    maxord    maximum legendre order                            *  ccccr.59   
c     *    ifopt     matrix blocking option (1/2=blocking by           *  ccccr.60   
c     *                               reaction/legendre order)         *  ccccr.61   
c     * card 5 isotope parameters (one card per isotope)               *  ccccr.62   
c     *       (first four words are hollerith, up to six characters    *  ccccr.63   
c     *       each, delimited by *)                                    *  ccccr.64   
c     *    hisnm     hollerith isotope label                           *  ccccr.65   
c     *    habsid    hollerith absolute isotope label                  *  ccccr.66   
c     *    hident    identifier of data source library (endf/b)        *  ccccr.67   
c     *    hmat      isotope identification                            *  ccccr.68   
c     *    imat      numerical isotope identifier (endf/b mat number)  *  ccccr.69   
c     *    xspo      average potential scattering cross sect. (brkoxs) *  ccccr.70   
c     *                                                                *  ccccr.71   
c     *-cisotx- (only if nisot.gt.0)                                   *  ccccr.72   
c     * card 1 file control                                            *  ccccr.73   
c     *    nsblok    subblocking option for scattering matrix          *  ccccr.74   
c     *              (1 or ngrup sub-blocks allowed)                   *  ccccr.75   
c     *    maxup     maximum number of upscatter groups (always zero)  *  ccccr.76   
c     *    maxdn     maximum number of downscatter groups              *  ccccr.77   
c     *    ichix     fission chi representation                        *  ccccr.78   
c     *                   -1   vector (using groupr flux)              *  ccccr.79   
c     *                    0   none                                    *  ccccr.80   
c     *                   +1   vector (using input flux)               *  ccccr.81   
c     *                .gt.1   matrix                                  *  ccccr.82   
c     * card 2 chi vector control (ichix=1 only)                       *  ccccr.83   
c     *    spec      ngroup flux values used to collapse the groupr    *  ccccr.84   
c     *              fission matrix into a chi vector                  *  ccccr.85   
c     * card 3 chi matrix control (ichix.gt.1 only)                    *  ccccr.86   
c     *    spec      ngroup values of spec(i)=k define the range of    *  ccccr.87   
c     *              groups i to be averaged to obtain spectrum k.     *  ccccr.88   
c     *              index k ranges from 1 to ichi.                    *  ccccr.89   
c     *              the model flux is used to weight each group i.    *  ccccr.90   
c     * card 4 isotope control (one card per isotope)                  *  ccccr.91   
c     *    kbr       isotope classification                            *  ccccr.92   
c     *    amass     gram atomic weight                                *  ccccr.93   
c     *    efiss     total thermal energy/fission                      *  ccccr.94   
c     *    ecapt     total thermal energy/capture                      *  ccccr.95   
c     *    temp      isotope temperature                               *  ccccr.96   
c     *    sigpot     average effective potential scattering           *  ccccr.97   
c     *    adens     density of isotope in mixture                     *  ccccr.98   
c     *                                                                *  ccccr.99   
c     *-cbrkxs- (only if nbrks.gt.0)                                   *  ccccr.100  
c     * card 1 (2i6) file data                                         *  ccccr.101  
c     *    nti       number of temperatures desired                    *  ccccr.102  
c     *              (-n means accept first n temperatures)            *  ccccr.103  
c     *    nzi       number of sigpo values desire                     *  ccccr.104  
c     *              (-n means accept first n dilution factors)        *  ccccr.105  
c     * card 2 (not needed if nti.lt.0)                                *  ccccr.106  
c     *    atem(nti) values of desired temperatures                    *  ccccr.107  
c     * card 3 (not needed if nzi.lt.0)                                *  ccccr.108  
c     *    asig(nzi) values of desired sigpo                           *  ccccr.109  
c     *                                                                *  ccccr.110  
c     *-cdlayx-- no input required                                     *  ccccr.111  
c     *                                                                *  ccccr.112  
c     ******************************************************************  ccccr.113  

MATSXR
      subroutine matxsr                                                  matxsr.3    
c                                                                        matxsr.4    
c     ****************************************************************** matxsr.5    
c     *                                                                * matxsr.6    
c     *  produce matxs interface file from njoy intermediate cross     * matxsr.7    
c     *  section data from group or gaminr                             * matxsr.8    
c     *                                                                * matxsr.9    
c     *  the matxs file uses a generalized, flexible format based on   * matxsr.10   
c     *  the cccc interface conventions.  working from groupr and/or   * matxsr.11   
c     *  gaminr output tapes, this module can process neutron,         * matxsr.12   
c     *  thermal, photon, and charged-particle data into a             * matxsr.13   
c     *  single output file.  this file can then be used by the        * matxsr.14   
c     *  transx code to prepare data libraries for transport codes.    * matxsr.15   
c     *                                                                  matxsr.16   
c     *  a matxs file specification may be found following the         * matxsr.17   
c     *  input instructions.                                           * matxsr.18   
c     *                                                                * matxsr.19   
c     *---input specifications (free format)---------------------------* matxsr.20   
c     *                                                                * matxsr.21   
c     * card 1 units                                                   * matxsr.22   
c     *   ngen1     input unit for data from groupr                    * matxsr.23   
c     *   ngen2     input unit for data from gaminr                    * matxsr.24   
c     *   nmatx     output unit for matxs                              * matxsr.25   
c     *   ngen3     incident proton data from groupr (default=0)       * matxsr.26   
c     *   ngen4     incident deuteron data from groupr (default=0)     * matxsr.27   
c     *   ngen5     incident triton data from groupr (default=0)       * matxsr.28   
c     *   ngen6     incident he3 data from groupr (default=0)          * matxsr.29   
c     *   ngen7     incident alpha data from groupr (default=0)        * matxsr.30   
c     *   ngen8     photonuclear data from groupr (default=0)          *   up67.5    
c     * card 2 user identification                                     * matxsr.31   
c     *   ivers     file version number (default=0)                    * matxsr.32   
c     *   huse      user id (up to 16 characters, delimited by *,      * matxsr.33   
c     *             ended by /) (default=blank)                        * matxsr.34   
c     * card 3 file control                                            * matxsr.35   
c     *   npart     number of particles for which group                * matxsr.36   
c     *                structures are given                            * matxsr.37   
c     *   ntype     number of data types in set                        * matxsr.38   
c     *   nholl     number of cards to be read for hollerith           * matxsr.39   
c     *             identification record.                             * matxsr.40   
c     *   nmat      number of materials desired                        * matxsr.41   
c     * card 4 set hollerith identification                            * matxsr.42   
c     *   hsetid    hollerith identification of set                    * matxsr.43   
c     *             (each line can be up to 72 characters,             * matxsr.44   
c     *             delimited with *, ended by /)                      * matxsr.45   
c     * card 5 particle identifiers                                    * matxsr.46   
c     *   hpart     hollerith identifiers for particles                * matxsr.47   
c     *             (up to 8 characters each)                          * matxsr.48   
c     * card 6 energy groups                                           * matxsr.49   
c     *   ngrp      number of groups for each particle                 * matxsr.50   
c     * card 7 data type identifiers                                   * matxsr.51   
c     *   htype     hollerith identifiers for data types               * matxsr.52   
c     *             (up to 8 characters each)                          * matxsr.53   
c     * card 8 input particle ids                                      * matxsr.54   
c     *   jinp     input particle id for each data type                * matxsr.55   
c     * card 9 output particle ids                                     * matxsr.56   
c     *   joutp    output particle id for each data type               * matxsr.57   
c     * card 10 material data (one card per material)                  * matxsr.58   
c     *   hmat      hollerith material identifier                      * matxsr.59   
c     *             (up to 8 characters each)                          * matxsr.60   
c     *   matno     integer material identifier                        * matxsr.61   
c     *             (endf/b mat number)                                * matxsr.62   
c     *   matgg     mat number for photoatomic data                    * matxsr.63   
c     *             (default=100*(matno/100) as in endf-6)             * matxsr.64   
c     *                                                                * matxsr.65   
c     ****************************************************************** matxsr.66   
c                                                                        matxsr.67   
c                                                                        matxsr.68   
c*********************************************************************** matxsr.69   
c               proposed 09/09/77                                      - matxsr.70   
c                       (modified 09/80)                               - matxsr.71   
c                       (nomenclature changed 06/88)                   - matxsr.72   
c                       (modified for const sub-blocks 06/90)          - matxsr.73   
c                       (ordering changed 10/90)                       - matxsr.74   
c     c                       (bcd format changed 12/21/91)              matxsr.75   
c                                                                      - matxsr.76   
cf           matxs                                                     - matxsr.77   
ce           material cross section file                               - matxsr.78   
c                                                                      - matxsr.79   
cn                       this file contains cross section              - matxsr.80   
cn                       vectors and matrices for all                  - matxsr.81   
cn                       particles, materials, and reactions;          - matxsr.82   
cn                       delayed neutron spectra by time group;        - matxsr.83   
cn                       and decay heat and photon spectra.            - matxsr.84   
c                                                                      - matxsr.85   
cn           formats given are for file exchange only                  - matxsr.86   
c                                                                      - matxsr.87   
c*********************************************************************** matxsr.88   
c                                                                        matxsr.89   
c                                                                        matxsr.90   
c----------------------------------------------------------------------- matxsr.91   
cs          file structure                                             - matxsr.92   
cs                                                                     - matxsr.93   
cs              record type                       present if           - matxsr.94   
cs              ==============================    ===============      - matxsr.95   
cs              file identification                 always             - matxsr.96   
cs              file control                        always             - matxsr.97   
cs              set hollerith identification        always             - matxsr.98   
cs              file data                           always             - matxsr.99   
cs                                                                     - matxsr.100  
cs   *************(repeat for all particles)                           - matxsr.101  
cs   *          group structures                    always             - matxsr.102  
cs   *************                                                     - matxsr.103  
cs                                                                     - matxsr.104  
cs   *************(repeat for all materials)                           - matxsr.105  
cs   *          material control                    always             - matxsr.106  
cs   *                                                                 - matxsr.107  
cs   * ***********(repeat for all submaterials)                        - matxsr.108  
cs   * *        vector control                      n1db.gt.0          - matxsr.109  
cs   * *                                                               - matxsr.110  
cs   * * *********(repeat for all vector blocks)                       - matxsr.111  
cs   * * *      vector block                        n1db.gt.0          - matxsr.112  
cs   * * *********                                                     - matxsr.113  
cs   * *                                                               - matxsr.114  
cs   * * *********(repeat for all matrix blocks)                       - matxsr.115  
cs   * * *      matrix control                      n2d.gt.0           - matxsr.116  
cs   * * *                                                             - matxsr.117  
cs   * * * *******(repeat for all sub-blocks)                          - matxsr.118  
cs   * * * *    matrix sub-block                    n2d.gt.0           - matxsr.119  
cs   * * * *******                                                     - matxsr.120  
cs   * * *                                                             - matxsr.121  
cs   * * *      constant sub-block                  jconst.gt.0        - matxsr.122  
cs   * * *                                                             - matxsr.123  
cs   *************                                                     - matxsr.124  
c                                                                      - matxsr.125  
c----------------------------------------------------------------------- matxsr.126  
c                                                                        matxsr.127  
c                                                                        matxsr.128  
c----------------------------------------------------------------------- matxsr.129  
cr           file identification                                       - matxsr.130  
c                                                                      - matxsr.131  
cl    hname,(huse(i),i=1,2),ivers                                      - matxsr.132  
c                                                                      - matxsr.133  
cw    1+3*mult                                                         - matxsr.134  
c                                                                      - matxsr.135  
cb    format(4h 0v ,a8,1h*,2a8,1h*,i6)                                   matxsr.136  
c                                                                      - matxsr.137  
cd    hname         hollerith file name  - matxs -  (a8)               - matxsr.138  
cd    huse          hollerith user identifiation    (a8)               - matxsr.139  
cd    ivers         file version number                                - matxsr.140  
cd    mult          double precision parameter                         - matxsr.141  
cd                       1- a8 word is single word                     - matxsr.142  
cd                       2- a8 word is double precision word           - matxsr.143  
c                                                                      - matxsr.144  
c----------------------------------------------------------------------- matxsr.145  
c                                                                        matxsr.146  
c                                                                        matxsr.147  
c----------------------------------------------------------------------- matxsr.148  
cr           file control                                              - matxsr.149  
c                                                                      - matxsr.150  
cl    npart,ntype,nholl,nmat,maxw,length                               - matxsr.151  
c                                                                      - matxsr.152  
cw    6                                                                - matxsr.153  
c                                                                      - matxsr.154  
cb    format(6h 1d   ,6i6)                                               matxsr.155  
c                                                                      - matxsr.156  
cd    npart       number of particles for which group                  - matxsr.157  
cd                   structures are given                              - matxsr.158  
cd    ntype       number of data types present in set                  - matxsr.159  
cd    nholl       number of words in set hollerith                     - matxsr.160  
cd                    identification record                            - matxsr.161  
cd    nmat        number of materials on file                          - matxsr.162  
cd    maxw        maximum record size for sub-blocking                 - matxsr.163  
cd    length      length of file                                       - matxsr.164  
c                                                                      - matxsr.165  
c----------------------------------------------------------------------- matxsr.166  
c                                                                        matxsr.167  
c                                                                        matxsr.168  
c----------------------------------------------------------------------- matxsr.169  
cr           set hollerith identification                              - matxsr.170  
c                                                                      - matxsr.171  
cl    (hsetid(i),i=1,nholl)                                            - matxsr.172  
c                                                                      - matxsr.173  
cw    nholl*mult                                                       - matxsr.174  
c                                                                      - matxsr.175  
cb    format(4h 2d /(9a8))                                               matxsr.176  
c                                                                      - matxsr.177  
cd    hsetid      hollerith identification of set (a8)                 - matxsr.178  
cd                 (to be edited out 72 characters per line)           - matxsr.179  
c                                                                      - matxsr.180  
c----------------------------------------------------------------------- matxsr.181  
c                                                                        matxsr.182  
c                                                                        matxsr.183  
c----------------------------------------------------------------------- matxsr.184  
cr          file data                                                  - matxsr.185  
c                                                                      - matxsr.186  
cl    (hprt(j),j=1,npart),(htype(k),k=1,ntype),(hmatn(i),i=1,nmat),    - matxsr.187  
cl   1(ngrp(j),j=1,npart),(jinp(k),k=1,ntype,(joutp(k),k=1,ntype),     - matxsr.188  
cl   2(nsubm(i)i=1,nmat),(locm(i),i=1,nmat)                            - matxsr.189  
c                                                                      - matxsr.190  
cw    (npart+ntype+nmat)*mult+2*ntype+npart+2*nmat                     - matxsr.191  
c                                                                      - matxsr.192  
cb    format(4h 3d ,4x,8a8/(9a8))    hprt,htype,hmatn                    matxsr.193  
cb    format(12i6)                  ngrp,jinp,joutp,nsubm,locm         - matxsr.194  
c                                                                      - matxsr.195  
cd    hprt(j)     hollerith identification for particle j              - matxsr.196  
cd                     n         neutron                               - matxsr.197  
cd                     g         gamma                                 - matxsr.198  
cd                     p         proton                                - matxsr.199  
cd                     d         deuteron                              - matxsr.200  
cd                     t         triton                                - matxsr.201  
cd                     h         he-3 nucleus                          - matxsr.202  
cd                     a         alpha (he-4 nucleus)                  - matxsr.203  
cd                     b         beta                                  - matxsr.204  
cd                     r         residual or recoil                    - matxsr.205  
cd                               (heavier than alpha)                  - matxsr.206  
cd    htype(k)     hollerith identification for data type k            - matxsr.207  
cd                     nscat     neutron scattering                    - matxsr.208  
cd                     ng        neutron induced gamma production      - matxsr.209  
cd                     gscat     gamma scattering (atomic)             -   up67.7    
cd                     gg        gamma scattering (photonuclear)       -   up67.8    
cd                     pn        proton induced neutron production     - matxsr.211  
cd                       .          .                                  - matxsr.212  
cd                       .          .                                  - matxsr.213  
cd                       .          .                                  - matxsr.214  
cd                     dkn       delayed neutron data                  - matxsr.215  
cd                     dkhg      decay heat and gamma data             - matxsr.216  
cd                     dkb       decay beta data                       - matxsr.217  
cd    hmatn(i)    hollerith identification for material i              - matxsr.218  
cd    ngrp(j)      number of energy groups for particle j              - matxsr.219  
cd    jinp(k)     type of incident particle associated with            - matxsr.220  
cd                   data type k.  for dk data types, jinp is 0.       - matxsr.221  
cd    joutp(k)    type of outgoing particle associated with            - matxsr.222  
cd                   data type k                                       - matxsr.223  
cd    nsubm(i)    number of submaterials for material i                - matxsr.224  
cd    locm(i)     location of material i                               - matxsr.225  
c                                                                      - matxsr.226  
c----------------------------------------------------------------------- matxsr.227  
c                                                                        matxsr.228  
c                                                                        matxsr.229  
c----------------------------------------------------------------------- matxsr.230  
cr          group structure                                            - matxsr.231  
c                                                                      - matxsr.232  
cl    (gpb(i),i=1,ngr),emin                                            - matxsr.233  
c                                                                      - matxsr.234  
cc    ngr=ngrp(j)                                                      - matxsr.235  
c                                                                      - matxsr.236  
cw    ngrp(j)+1                                                        - matxsr.237  
c                                                                      - matxsr.238  
cb    format(4h 4d ,8x,1p,5e12.5/(6e12.5))                               matxsr.239  
c                                                                      - matxsr.240  
cd    gpb(i)      maximum energy bound for group i for particle j      - matxsr.241  
cd    emin        minimum energy bound for particle j                  - matxsr.242  
c                                                                      - matxsr.243  
c----------------------------------------------------------------------- matxsr.244  
c                                                                        matxsr.245  
c                                                                        matxsr.246  
c----------------------------------------------------------------------- matxsr.247  
cr          material control                                           - matxsr.248  
c                                                                      - matxsr.249  
cl    hmat,amass,(temp(i),sigz(i),itype(i),n1d(i),n2d(i),              - matxsr.250  
cl   1locs(i),i=1,nsubm)                                               - matxsr.251  
c                                                                      - matxsr.252  
cw    mult+1+6*nsubm                                                   - matxsr.253  
c                                                                      - matxsr.254  
cb    format(4h 5d ,a8,1p,2e12.5/(2e12.5,5i6))                           matxsr.255  
c                                                                      - matxsr.256  
cd    hmat        hollerith material identifier                        - matxsr.257  
cd    amass       atomic weight ratio                                  - matxsr.258  
cd    temp        ambient temperature or other parameters for          - matxsr.259  
cd                    submaterial i                                    - matxsr.260  
cd    sigz        dilution factor or other parameters for              - matxsr.261  
cd                    submaterial i                                    - matxsr.262  
cd    itype       data type for submaterial i                          - matxsr.263  
cd    n1d         number of vectors for submaterial i                  - matxsr.264  
cd    n2d         number of matrix blocks for submaterial i            - matxsr.265  
cd    locs        location of submaterial i                            - matxsr.266  
c                                                                      - matxsr.267  
c----------------------------------------------------------------------- matxsr.268  
c                                                                        matxsr.269  
c                                                                        matxsr.270  
c----------------------------------------------------------------------- matxsr.271  
cr          vector control                                             - matxsr.272  
c                                                                      - matxsr.273  
cl    (hvps(i),i=1,n1d),(nfg(i),i=1,n1d),(nlg(i),i=1,n1d)              - matxsr.274  
c                                                                      - matxsr.275  
cw    (mult+2)*n1d                                                     - matxsr.276  
c                                                                      - matxsr.277  
cb    format(4h 6d ,4x,8a8/(9a8))      hvps                              matxsr.278  
cb    format(12i6)                    iblk,nfg,nlg                     - matxsr.279  
c                                                                      - matxsr.280  
cd    hvps(i)     hollerith identifier of vector                       - matxsr.281  
cd                      nelas     neutron elastic scattering           - matxsr.282  
cd                      n2n       (n,2n)                               - matxsr.283  
cd                      nnf       second chance fission                - matxsr.284  
cd                      gabs      gamma absorption                     - matxsr.285  
cd                      p2n       protons in, 2 neutrons out           - matxsr.286  
cd                         .          .                                - matxsr.287  
cd                         .          .                                - matxsr.288  
cd                         .          .                                - matxsr.289  
cd    nfg(i)      number of first group in band for vector i           - matxsr.290  
cd    nlg(i)      number of last group in band for vector i            - matxsr.291  
c                                                                      - matxsr.292  
c----------------------------------------------------------------------- matxsr.293  
c                                                                        matxsr.294  
c                                                                        matxsr.295  
c----------------------------------------------------------------------- matxsr.296  
cr          vector block                                               - matxsr.297  
c                                                                      - matxsr.298  
cl    (vps(i),i=1,kmax)                                                - matxsr.299  
c                                                                      - matxsr.300  
cc    kmax=sum over group band for each vector in block j              - matxsr.301  
c                                                                      - matxsr.302  
cw    kmax                                                             - matxsr.303  
c                                                                      - matxsr.304  
cb    format(4h 7d ,8x,1p,5e12.5/(6e12.5))                               matxsr.305  
c                                                                      - matxsr.306  
cd    vps(i)      data for group bands for vectors in block j.         - matxsr.307  
cd                block size is determined by taking all the group     - matxsr.308  
cd                bands that have a total length less than or equal    - matxsr.309  
cd                to maxw.                                             - matxsr.310  
c                                                                      - matxsr.311  
c----------------------------------------------------------------------- matxsr.312  
c                                                                        matxsr.313  
c                                                                        matxsr.314  
c----------------------------------------------------------------------- matxsr.315  
cr        scattering matrix control                                    - matxsr.316  
c                                                                      - matxsr.317  
cl    hmtx,lord,jconst,                                                  matxsr.318  
cl   1(jband(l),l=1,noutg(k)),(ijj(l),l=1,noutg(k))                    - matxsr.319  
c                                                                      - matxsr.320  
cw    mult+2+2*noutg(k)                                                - matxsr.321  
c                                                                      - matxsr.322  
cb    format(4h 8d ,4x,a8/(12i6))      hmtx,lord,jconst,                 matxsr.323  
cb                                     jband,ijj                       - matxsr.324  
c                                                                      - matxsr.325  
cd    hmtx        hollerith identification of block                    - matxsr.326  
cd    lord        number of orders present                             - matxsr.327  
cd    jconst      number of groups with constant spectrum              - matxsr.328  
cd    jband(l)    bandwidth for group l                                - matxsr.329  
cd    ijj(l)      lowest group in band for group l                     - matxsr.330  
c                                                                      - matxsr.331  
c----------------------------------------------------------------------- matxsr.332  
c                                                                        matxsr.333  
c                                                                        matxsr.334  
c----------------------------------------------------------------------- matxsr.335  
cr          scattering sub-block                                       - matxsr.336  
c                                                                      - matxsr.337  
cl    (scat(k),k=1,kmax)                                               - matxsr.338  
c                                                                      - matxsr.339  
cc    kmax=lord times the sum over all jband in the group range of     - matxsr.340  
cc            this sub-block                                           - matxsr.341  
c                                                                      - matxsr.342  
cb    format(4h 9d ,8x,1p,5e12.5/(6e12.5))                               matxsr.343  
c                                                                      - matxsr.344  
cw    kmax                                                             - matxsr.345  
c                                                                      - matxsr.346  
cd    scat(k)     matrix data given as bands of elements for initial   - matxsr.347  
cd                groups that lead to each final group.  the order     - matxsr.348  
cd                of the elements is as follows:  band for p0 of       - matxsr.349  
cd                group i, band for p1 of group i, ... , band for p0   - matxsr.350  
cd                of group i+1, band for p1 of group i+1, etc.  the    - matxsr.351  
cd                groups in each band are given in descending order.   - matxsr.352  
cd                the size of each sub-block is determined by the      - matxsr.353  
cd                total length of a group of bands that is less than   - matxsr.354  
cd                or equal to maxw.                                    - matxsr.355  
cd                                                                     - matxsr.356  
cd                if jconst.gt.0, the contributions from the jconst    - matxsr.357  
cd                low-energy groups are given separately.              - matxsr.358  
c                                                                      - matxsr.359  
c----------------------------------------------------------------------- matxsr.360  
c                                                                      - matxsr.361  
c                                                                      - matxsr.362  
c----------------------------------------------------------------------- matxsr.363  
cr          constant sub-block                                         - matxsr.364  
c                                                                      - matxsr.365  
cl    (spec(l),l=1,noutg(k)),(prod(l),l=l1,ning(k))                    - matxsr.366  
c                                                                      - matxsr.367  
cc    l1=ning(k)-jconst+1                                              - matxsr.368  
c                                                                      - matxsr.369  
cw    noutg(k)+jconst                                                  - matxsr.370  
c                                                                      - matxsr.371  
cb    format(4h10d ,8x,1p,5e12.5/(6e12.5))                               matxsr.372  
c                                                                      - matxsr.373  
cd    spec        normalized spectrum of final particles for initial   - matxsr.374  
cd                particles in groups l1 to ning(k)                    - matxsr.375  
cd    prod        production cross section (e.g., nu*sigf) for         - matxsr.376  
cd                initial groups l1 through ning(k)                    - matxsr.377  
cd                                                                     - matxsr.378  
cd         this option is normally used for the energy-independent     - matxsr.379  
cd         neutron and photon spectra from fission and radiative       - matxsr.380  
cd         capture usually seen at low energies.                       - matxsr.381  
c                                                                      - matxsr.382  
c----------------------------------------------------------------------- matxsr.383  
c                                                                        matxsr.384  
c     ****************************************************************** matxsr.385  

RESXSR
      subroutine resxsr                                                  resxsr.3    
c                                                                        resxsr.4    
c     ****************************************************************** resxsr.5    
c     *                                                                * resxsr.6    
c     *  construct an resxs resonance cross section                    * resxsr.7    
c     *  file from njoy pendf cross sections.                          * resxsr.8    
c     *                                                                * resxsr.9    
c     *  user input                                                    * resxsr.10   
c     *                                                                * resxsr.11   
c     *   card 1   units                                               * resxsr.12   
c     *      nout     output unit                                      * resxsr.13   
c     *                                                                * resxsr.14   
c     *   card 2   control                                             * resxsr.15   
c     *      nmat     number of materials                              * resxsr.16   
c     *      maxt     max. number of temperatures                      * resxsr.17   
c     *      nholl    number of lines of descriptive comments          * resxsr.18   
c     *      efirst   lower energy limit (ev)                          * resxsr.19   
c     *      elast    upper energy limit                               * resxsr.20   
c     *      eps      thinning tolerance                               * resxsr.21   
c     *                                                                * resxsr.22   
c     *   card 3   user id                                             * resxsr.23   
c     *      huse     hollerith user identification (up to 16 chars)   * resxsr.24   
c     *      ivers    file version number                              * resxsr.25   
c     *                                                                * resxsr.26   
c     *   card 4   descriptive data (repeat nholl times)               * resxsr.27   
c     *      holl     line of hollerith data (72 chars max)            * resxsr.28   
c     *                                                                * resxsr.29   
c     *   card 5   material specifications (repeat nmat times)         * resxsr.30   
c     *      hmat     hollerith name for material (up to 8 chars)      * resxsr.31   
c     *      mat      endf mat number for material                     * resxsr.32   
c     *      unit     njoy unit number for pendf data                  * resxsr.33   
c     *                                                                * resxsr.34   
c     *       the resxs format specification follows:                  * resxsr.35   
c     *                                                                * resxsr.36   
c*********************************************************************** resxsr.37   
c               proposed 09/24/90                                      - resxsr.38   
c                                                                      - resxsr.39   
cf           resxs                                                     - resxsr.40   
ce           resonance cross section file                              - resxsr.41   
c                                                                      - resxsr.42   
cn                       this file contains pointwise cross            - resxsr.43   
cn                       sections for the epithermal resonance         - resxsr.44   
cn                       range to be used for hyper-fine flux          - resxsr.45   
cn                       calculations.  elastic, fission, and          - resxsr.46   
cn                       capture cross sections are given vs           - resxsr.47   
cn                       temperature.  linear interpolation is         - resxsr.48   
cn                       assumed.                                      - resxsr.49   
c                                                                      - resxsr.50   
cn           formats given are for file exchange only                  - resxsr.51   
c                                                                      - resxsr.52   
c*********************************************************************** resxsr.53   
c                                                                        resxsr.54   
c                                                                        resxsr.55   
c----------------------------------------------------------------------- resxsr.56   
cs          file structure                                             - resxsr.57   
cs                                                                     - resxsr.58   
cs              record type                       present if           - resxsr.59   
cs              ==============================    ===============      - resxsr.60   
cs              file identification                 always             - resxsr.61   
cs              file control                        always             - resxsr.62   
cs              set hollerith identification        always             - resxsr.63   
cs              file data                           always             - resxsr.64   
cs                                                                     - resxsr.65   
cs   *************(repeat for all materials)                           - resxsr.66   
cs   *          material control                    always             - resxsr.67   
cs   *                                                                 - resxsr.68   
cs   * ***********(repeat for all cross section blocks)                - resxsr.69   
cs   * *        cross section block                 always             - resxsr.70   
cs   * ***********                                                     - resxsr.71   
cs   *************                                                     - resxsr.72   
c                                                                      - resxsr.73   
c----------------------------------------------------------------------- resxsr.74   
c                                                                        resxsr.75   
c                                                                        resxsr.76   
c----------------------------------------------------------------------- resxsr.77   
cr           file identification                                       - resxsr.78   
c                                                                      - resxsr.79   
cl    hname,(huse(i),i=1,2),ivers                                      - resxsr.80   
c                                                                      - resxsr.81   
cw    1+3*mult                                                         - resxsr.82   
c                                                                      - resxsr.83   
cb    format(4h ov ,a8,1h*,2a8,1h*,i6)                                 - resxsr.84   
c                                                                      - resxsr.85   
cd    hname         hollerith file name  - resxs -  (a8)               - resxsr.86   
cd    huse          hollerith user identifiation    (a8)               - resxsr.87   
cd    ivers         file version number                                - resxsr.88   
cd    mult          double precision parameter                         - resxsr.89   
cd                       1- a8 word is single word                     - resxsr.90   
cd                       2- a8 word is double precision word           - resxsr.91   
c                                                                      - resxsr.92   
c----------------------------------------------------------------------- resxsr.93   
c                                                                        resxsr.94   
c                                                                        resxsr.95   
c----------------------------------------------------------------------- resxsr.96   
cr           file control                                              - resxsr.97   
c                                                                      - resxsr.98   
cl    efirst,elast,nholl,nmat,nblok                                      resxsr.99   
c                                                                      - resxsr.100  
cw    5                                                                - resxsr.101  
c                                                                      - resxsr.102  
cb    format(4h 1d ,2i6)                                               - resxsr.103  
c                                                                      - resxsr.104  
cd    efirst      lowest energy on file (ev)                           - resxsr.105  
cd    elast       highest enery on file (ev)                           - resxsr.106  
cd    nholl       number of words in set hollerith                     - resxsr.107  
cd                    identification record                            - resxsr.108  
cd    nmat        number of materials on file                          - resxsr.109  
cd    nblok       energy blocking factor                               - resxsr.110  
c                                                                      - resxsr.111  
c----------------------------------------------------------------------- resxsr.112  
c                                                                        resxsr.113  
c                                                                        resxsr.114  
c----------------------------------------------------------------------- resxsr.115  
cr           set hollerith identification                              - resxsr.116  
c                                                                      - resxsr.117  
cl    (hsetid(i),i=1,nholl)                                            - resxsr.118  
c                                                                      - resxsr.119  
cw    nholl*mult                                                       - resxsr.120  
c                                                                      - resxsr.121  
cb    format(4h 2d ,8a8/(9a8))                                         - resxsr.122  
c                                                                      - resxsr.123  
cd    hsetid      hollerith identification of set (a8)                 - resxsr.124  
cd                 (to be edited out 72 characters per line)           - resxsr.125  
c                                                                      - resxsr.126  
c----------------------------------------------------------------------- resxsr.127  
c                                                                        resxsr.128  
c                                                                        resxsr.129  
c----------------------------------------------------------------------- resxsr.130  
cr          file data                                                  - resxsr.131  
c                                                                      - resxsr.132  
cl    (hmatn(i),i=1,nmat),(ntemp(i),i=1,nmat),(locm(i),i=1,nmat)       - resxsr.133  
c                                                                      - resxsr.134  
cw    (mult+2)*nmat                                                    - resxsr.135  
c                                                                      - resxsr.136  
cb    format(4h 3d ,8a8/(9a8))      hmatn                              - resxsr.137  
cb    format(12i6)                  ntemp,locm                         - resxsr.138  
c                                                                      - resxsr.139  
cd    hmatn(i)    hollerith identification for material i              - resxsr.140  
cd    ntemp(i)    number of temperatures for material i                - resxsr.141  
cd    locm(i)     location of material i                               - resxsr.142  
c                                                                      - resxsr.143  
c----------------------------------------------------------------------- resxsr.144  
c                                                                        resxsr.145  
c                                                                        resxsr.146  
c----------------------------------------------------------------------- resxsr.147  
cr          material control                                           - resxsr.148  
c                                                                      - resxsr.149  
cl    hmat,amass,(temp(i),i=1,ntemp),nreac,nener                       - resxsr.150  
c                                                                      - resxsr.151  
cw    mult+3+ntemp                                                     - resxsr.152  
c                                                                      - resxsr.153  
cb    format(4h 6d ,a8,1h*,1p1e12.5/(6e12.5))     hmat,temp            - resxsr.154  
cb    format(2i6)                                 nener,blok           - resxsr.155  
c                                                                      - resxsr.156  
cd    hmat        hollerith material identifier                        - resxsr.157  
cd    amass       atomic weight ratio                                  - resxsr.158  
cd    temp        temperature values for this material                 - resxsr.159  
cd    nreac       number of reactions for this material                - resxsr.160  
cd                  (3 for fissionable, 2 for nonfissionable)          - resxsr.161  
cd    nener       number of energies for this material                 - resxsr.162  
c                                                                      - resxsr.163  
c----------------------------------------------------------------------- resxsr.164  
c                                                                        resxsr.165  
c                                                                        resxsr.166  
c----------------------------------------------------------------------- resxsr.167  
cr          cross section block                                        - resxsr.168  
c                                                                      - resxsr.169  
cl    (xsb(i),i=1,imax)                                                - resxsr.170  
c                                                                      - resxsr.171  
cc    imax=3*ntemp*(number of energies in the block)                   - resxsr.172  
c                                                                      - resxsr.173  
cw    imax                                                             - resxsr.174  
c                                                                      - resxsr.175  
cb    format(4h 8d ,1p5e12.5/(6e12.5))                                 - resxsr.176  
c                                                                      - resxsr.177  
cd    xsb(i)      data for a block of nblok or fewer point energy      - resxsr.178  
cd                values.  the data values given for each energy       - resxsr.179  
cd                are nelas, nfis, and ng at temp(1), followed by      - resxsr.180  
cd                nelas, nfis, and ng at temp(2), and so on.           - resxsr.181  
c                                                                      - resxsr.182  
c----------------------------------------------------------------------- resxsr.183  
c                                                                        resxsr.184  

ACER
      subroutine acer                                                      acer.3    
c                                                                          acer.4    
c     ******************************************************************   acer.5    
c     *                                                                *   acer.6    
c     * prepare a data library for mcnp,                               *   acer.7    
c     * the los alamos continuous energy monte carlo code              *   acer.8    
c     *                                                                *   acer.9    
c     *    --- continuous (fast) data ---                              *   acer.10   
c     *                                                                *   acer.11   
c     * reaction cross sections are reconstructed on the grid of the   *   acer.12   
c     * total cross section from the input pendf tape (assumed to be   *   acer.13   
c     * linearized and unionized).  redundant reactions (except for    *   acer.14   
c     * mt1, mt452, and reactions needed for photon yields) are        *   acer.15   
c     * removed.  mt18 is considered redundant if mt19 is present.     *   acer.16   
c     * angular distributions are converted into either 32 equally     *   acer.17   
c     * probable bins, or into cummulative probability distributions.  *   acer.18   
c     * tabulated energy distributions are converted into "law 4"      *   acer.19   
c     * probability distributions.  analytic secondary-energy          *   acer.20   
c     * distributions are converted into their ace formats.            *   acer.21   
c     * coupled energy-angle distributions (file 6) are converted      *   acer.22   
c     * into ace laws.  the old format supports law44 for tabulated    *   acer.23   
c     * data with kalbach systematics, law67 for angle-energy data,    *   acer.24   
c     * and law66 for phase space.  the newer format adds law61 with   *   acer.25   
c     * with cummulative angle distributions for legendre or tabulated *   acer.26   
c     * distributions (see newfor).  all photon production cross       *   acer.27   
c     * sections are combined on the cross section energy grid.        *   acer.28   
c     * if provided, multigroup photon production data is summed       *   acer.29   
c     * and converted into a set of equally probable emission          *   acer.30   
c     * energies for each input group.  detailed photon production     *   acer.31   
c     * data can be generated directly from files 12, 13, 14, 15,      *   acer.32   
c     * and 16 from the input endf tapes and written out using the     *   acer.33   
c     * "law 4" cummulative energy distribution format.                *   acer.34   
c     *                                                                *   acer.35   
c     *    --- thermal data ---                                        *   acer.36   
c     *                                                                *   acer.37   
c     * the data from the pendf tape as prepared by the thermr         *   acer.38   
c     * module is read in.  inelastic and incoherent elastic cross     *   acer.39   
c     * sections are stored directly.  coherent elastic cross          *   acer.40   
c     * sections are converted to a cummulative "stair step" form      *   acer.41   
c     * and stored.  the angular representation for incoherent         *   acer.42   
c     * elastic is stored directly.  none is needed for coherent       *   acer.43   
c     * elastic.  the incoherent inelastic energy distributions        *   acer.44   
c     * are converted into probability bins with the equally           *   acer.45   
c     * probable angles left unchanged.  the bins can have equal       *   acer.46   
c     * probabilities or variable probabilities.  in the latter        *   acer.47   
c     * case, outlying bins with smaller probabilities are provided    *   acer.48   
c     * to extend the sampling to rare events.  A new tabulated        *  up113.11   
c     * option uses a continuous tabulated probability distribution    *  up113.12   
c     * (pdf/cdf) (requires MCNP5.1.50 or later) and provides          *  up285.9    
c     *  extended plotting.                                            *  up113.14   
c     *                                                                *   acer.50   
c     *    --- dosimetry data ---                                      *   acer.51   
c     *                                                                *   acer.52   
c     * endf cross sections for dosimetry reactions are simply         *   acer.53   
c     * stored in ace format without changing the energy grid.         *   acer.54   
c     * the endf interpolation law is also provided.                   *   acer.55   
c     *                                                                *   acer.56   
c     *    --- photoatomic data ---                                    *   acer.57   
c     *                                                                *   acer.58   
c     * photon interaction cross sections are stored on the grid of    *   acer.59   
c     * the total cross section.  the coherent form factor is          *   acer.60   
c     * stored together with an integral over the form factor that     *   acer.61   
c     * is used in sampling for coherent scattering.  the              *   acer.62   
c     * incoherent scattering function is simply stored.  photon       *   acer.63   
c     * heating is calculated from the incoherent scattering data,     *   acer.64   
c     * the pair production data, and the photoelectric absorption     *   acer.65   
c     * data.  the input photoatomic data is mounted on nendf.         *   up69.12   
c     * fluorescence data can be generated from atomic relaxation      *   up69.13   
c     * data in endf format mounted on npend.                          *   up69.14   
c     *                                                                *   acer.67   
c     *    --- photonuclear data ---                                   *   acer.68   
c     *                                                                *   acer.69   
c     * photonuclear data are processed from new evaluations now       *   acer.70   
c     * available in endf format using a new ace format developed      *   acer.71   
c     * for mcnp and mcnpx.                                            *   acer.72   
c     *                                                                *   acer.73   
c     *    --- particle production ---                                 *   acer.74   
c     *                                                                *   acer.75   
c     * with the new format (see newfor), for charged particles, and   *   acer.76   
c     * for photonuclear data, new sections are written describing the *   acer.77   
c     * distributions of light particles produced that are different   *   acer.78   
c     * from the incident particle.                                    *   acer.79   
c     *                                                                *   acer.80   
c     *    --- incident charged particles ---                          *   acer.81   
c     *                                                                *   acer.82   
c     * incident charged particles are automatically recognized from   *   acer.83   
c     * the input tape.                                                *   acer.84   
c     *                                                                *   acer.85   
c     *    --- mcnpx format ---                                        *   acer.86   
c     *                                                                *   acer.87   
c     * mcnpx format is given to support a proposed extension of       *   acer.88   
c     * the zaid indentifier that uses three digits and two letters    *   acer.89   
c     * to the right of the decimal.  this will increase flexibility   *   acer.90   
c     * for handling exotic particles and provide more space for       *   acer.91   
c     * different data versions.  to request mcnpx format, set the     *   acer.92   
c     * value of iopt negative.                                        *   acer.93   
c     *                                                                *   acer.94   
c     *    --- output ---                                              *   acer.95   
c     *                                                                *   acer.96   
c     * the ace output file can be type 1 (formatted) or type 2        *   acer.97   
c     * (f77 binary).  type 3 is no longer used.  a line of file       *   acer.98   
c     * directory information is also written.  it must normally       *   acer.99   
c     * be edited to tell the system the path to the file.  acer       *   acer.100  
c     * can also be used to print, edit, or convert the mode of        *   acer.101  
c     * existing ace-format files.                                     *   acer.102  
c     *                                                                *   acer.103  
c     *---input specifications (free format)---------------------------*   acer.104  
c     *                                                                *   acer.105  
c     * card 1                                                         *   acer.106  
c     *    nendf    unit for input endf/b tape                         *   acer.107  
c     *    npend    unit for input pendf tape                          *   acer.108  
c     *    ngend    unit for input multigroup photon data              *   acer.109  
c     *    nace     unit for output ace tape                           *   acer.110  
c     *    ndir     unit for output mcnp directory                     *   acer.111  
c     * card 2                                                         *   acer.112  
c     *    iopt     type of acer run option                            *   acer.113  
c     *               1   fast data                                    *   acer.114  
c     *               2   thermal data                                 *   acer.115  
c     *               3   dosimetry data                               *   acer.116  
c     *               4   photo-atomic data                            *   acer.117  
c     *               5   photo-nuclear data                           *   acer.118  
c     *               7   read type 1 ace files to print or edit       *   acer.119  
c     *               8   read type 2 ace files to print or edit       *   acer.120  
c     *                set iopt negative for mcnpx format              *   acer.121  
c     *    iprint   print control (0 min, 1 max, default=1)            *   acer.122  
c     *    ntype    ace output type (1, 2, or 3, default=1)            *   acer.123  
c     *    suff     id suffix for zaid (default=.00)                   *   acer.124  
c     *    nxtra    number of iz,aw pairs to read in (default=0)       *   acer.125  
c     * card 3                                                         *   acer.126  
c     *    hk       descriptive character string (70 char max)         *   acer.127  
c     *             delimited by quotes                                *   acer.128  
c     * card 4 (nxtra.gt.0 only)                                       *   acer.129  
c     *    iz,aw    nxtra pairs of iz and aw                           *   acer.130  
c     *                                                                *   acer.131  
c     *    --- fast data (iopt=1 only) ---                             *   acer.132  
c     *                                                                *   acer.133  
c     * card 5                                                         *   acer.134  
c     *    matd     material to be processed                           *   acer.135  
c     *    tempd    temperature desired (kelvin) (default=300)         *   acer.136  
c     * card 6                                                         *   acer.137  
c     *    newfor   use new cummulative angle distributions,           *   acer.138  
c     *               law 61, and outgoing particle distributions.     *   acer.139  
c     *               (0=no, 1=yes, default=1)                         *   acer.140  
c     *    iopp     detailed photons (0=no, 1=yes, default=1)          *   acer.141  
c     * card 7                                                         *   acer.142  
c     *  type of thinning is determined by sign of thin(1)             *   acer.143  
c     *  (pos. or zero/neg.=energy skip/integral fraction)             *   acer.144  
c     *  (all entries defaulted=no thinning)                           *   acer.145  
c     *    thin(1)  e1 energy below which to use all energies (ev)     *   acer.146  
c     *             or iwtt weighting option (1=flat,2=1/e)            *   acer.147  
c     *             (1/e actually has weight=10 when e lt .1)          *   acer.148  
c     *    thin(2)  e2 energy above which to use all energies          *   acer.149  
c     *             or target number of points                         *   acer.150  
c     *    thin(3)  iskf skip factor--use every iskf-th energy         *   acer.151  
c     *             between e1 and e2, or rsigz reference sigma zero   *   acer.152  
c     *                                                                *   acer.153  
c     *   --- thermal data (iopt=2 only) ---                           *   acer.154  
c     *                                                                *   acer.155  
c     * card 8                                                         *   acer.156  
c     *    matd     material to be processed                           *   acer.157  
c     *    tempd    temperature desired (kelvin) (default=300)         *   acer.158  
c     *    tname    thermal zaid name ( 6 char max, def=za)            *   acer.159  
c     * card 8a                                                        *   acer.160  
c     *    iza01    moderator component za value                       *   acer.161  
c     *    iza02    moderator component za value (def=0)               *   acer.162  
c     *    iza03    moderator component za value (def=0)               *   acer.163  
c     * card 9                                                         *   acer.164  
c     *    mti      mt for thermal incoherent data                     *   acer.165  
c     *    nbint    number of bins for incoherent scattering           *   acer.166  
c     *    mte      mt for thermal elastic data                        *   acer.167  
c     *    ielas    0/1=coherent/incoherent elastic                    *   acer.168  
c     *    nmix     number of atom types in mixed moderator            *   acer.169  
c     *             (default=1, not mixed)                             *   acer.170  
c     *             (example, 2 for beo or c6h6)                       *   acer.171  
c     *    emax     maximum energy for thermal treatment (ev)          *   acer.172  
c     *             (default=1000.=determined from mf3, mti)           *   acer.173  
c     *    iwt      weighting option                                   *   acer.174  
c     *    iwt      0/1/2=variable/constant/tabulated (def=variable)   *  up113.16   
c     *                                                                *   acer.176  
c     *   --- dosimetry data (iopt=3 only) ---                         *   acer.177  
c     *                                                                *   acer.178  
c     * card 10                                                        *   acer.179  
c     *    matd     material to be processed                           *   acer.180  
c     *    tempd    temperature desired (kelvin) (default=300)         *   acer.181  
c     *                                                                *   acer.182  
c     *   --- photo-atomic data (iopt=4 only) ---                      *   acer.183  
c     *                                                                *   acer.184  
c     * card 11                                                        *   acer.185  
c     *    matd     material to be processed                           *   acer.186  
c     *             photoatomic data on nendf                          *   up69.16   
c     *             atomic relaxation data on npend                    *   up69.17   
c     *                                                                *   acer.187  
c     *   --- photo-nuclear data (iopt=5 only) ---                     *   acer.188  
c     *                                                                *   acer.189  
c     * card 11                                                        *   acer.190  
c     *    matd     material to be processed                           *   acer.191  
c     *                                                                *   acer.192  
c     *   --- print or edit existing files (iopt=7-9) ---              *   acer.193  
c     *                                                                *   acer.194  
c     *    no additional input cards are required.  mount the old      *   acer.195  
c     *    ace tape on "npend".  the code can modify zaid, hk,         *   acer.196  
c     *    the (iz,aw) list, and the type of the file.  use suff<0     *   acer.197  
c     *    to leave the old zaid unchanged.  use just "/" on           *   acer.198  
c     *    card 3 to leave the comment field hk unchanged.  use        *   acer.199  
c     *    nxtra=0 to leave the old iz,aw list unchanged.              *   acer.200  
c     *    the code can modify zaid, hk, and type of file.             *   acer.201  
c     *                                                                *   acer.202  
c     *   exhaustive consistency checks are automatically made on      *   acer.203  
c     *   the input file.  if ngend.ne.0, a set of standard ace plots  *   acer.204  
c     *   are prepared on unit ngend as plotr input instructions.      *   acer.205  
c     *                                                                *   acer.206  
c     ******************************************************************   acer.207  

POWR
      subroutine powr                                                      powr.3    
c                                                                          powr.4    
c     ******************************************************************   powr.5    
c     *                                                                *   powr.6    
c     *  produce input for the epri-cell codes gamtap (fast) and       *   powr.7    
c     *  librar (thermal), and the epri-cpm code clib.                 *   powr.8    
c     *                                                                *   powr.9    
c     *---input specifications (free format)---------------------------*   powr.10   
c     *                                                                *   powr.11   
c     * card 1                                                         *   powr.12   
c     *    ngendf  unit for input gout tape                            *   powr.13   
c     *    nout    unit for output tape                                *   powr.14   
c     * card 2                                                         *   powr.15   
c     *    lib     library option (1=fast, 2=thermal, 3=cpm)           *   powr.16   
c     *    iprint  print option (0=minimum, 1=maximum)                 *   powr.17   
c     *            (default=0)                                         *   powr.18   
c     *    iclaps  group collapsing option (0=collapse from 185 group  *   powr.19   
c     *            to desired group structure, 1=no collapse)          *   powr.20   
c     *            (default=0)                                         *   powr.21   
c     *                                                                *   powr.22   
c     *---for lib=1----------------------------------------------------*   powr.23   
c     *                                                                *   powr.24   
c     * card 3                                                         *   powr.25   
c     *    matd    material to be processed                            *   powr.26   
c     *            if matd lt 0, read-in absorption data only for      *   powr.27   
c     *            this material with mat=abs(matd) directly from      *   powr.28   
c     *            input deck (see card 6)                             *   powr.29   
c     *   following three parameters irrelevant for matd lt 0          *   powr.30   
c     *    rtemp   reference temperature (degrees kelvin)              *   powr.31   
c     *            (default=300  k)                                    *   powr.32   
c     *    iff     f-factor option                                     *   powr.33   
c     *            (0/1=do not calculate f-factors/calculate if found) *   powr.34   
c     *            (default=1)                                         *   powr.35   
c     *    nsgz    no. of sigma zeroes to process for this material    *   powr.36   
c     *            (default=0=all found on input tape)                 *   powr.37   
c     *    izref   ref. sigzero for elastic matrix (default=1)         *   powr.38   
c     * cards 4 and 5 for normal run only (matd gt 0)                  *   powr.39   
c     * card 4                                                         *   powr.40   
c     *    word    description of nuclide (up to 16 characters,        *   powr.41   
c     *            delimited with *, ended with /)  (default=blank)    *   powr.42   
c     * card 5                                                         *   powr.43   
c     *    fsn     title of fission spectrum (up to 40 characters,     *   powr.44   
c     *            delimited with *, ended with /0  (default=blank)    *   powr.45   
c     *             delimited with *, ended with /)  (default=blank)   *   powr.46   
c     * card 6 for reading in absorption data only                     *   powr.47   
c     *    abs     ngnd absorption values (default values=0)           *   powr.48   
c     * repeat cards 3 through 6 for each material desired.            *   powr.49   
c     * terminate with matd=0/ (i.e., a 0/ card).                      *   powr.50   
c     *                                                                *   powr.51   
c     *---for lib=2----------------------------------------------------*   powr.52   
c     *                                                                *   powr.53   
c     * card 3                                                         *   powr.54   
c     *    matd    material to be processed                            *   powr.55   
c     *    idtemp  temperature id (default=300  k)                     *   powr.56   
c     *    name    hollerith name of isotope (up to 10 characters,     *   powr.57   
c     *            delimited with *, ended with /)  (default=blank)    *   powr.58   
c     * card 4     default for all values=0.                           *   powr.59   
c     *    itrc    transport correction option (0 no, 1 yes)           *   powr.60   
c     *    mti     thermal inelastic mt                                *   powr.61   
c     *    mtc     thermal elastic mt                                  *   powr.62   
c     * card 5     default for all values=0.                           *   powr.63   
c     *    xi                                                          *   powr.64   
c     *    alpha                                                       *   powr.65   
c     *    mubar                                                       *   powr.66   
c     *    nu                                                          *   powr.67   
c     *    kappa fission                                               *   powr.68   
c     *    kappa capture                                               *   powr.69   
c     *    lambda                                                      *   powr.70   
c     *    sigma s   if 0, set to scattering cross section at group 35 *   powr.71   
c     * repeat cards 3 thru 5 for each material and temperature desired*   powr.72   
c     * (maximum number of temperatures allowed is 7.)                 *   powr.73   
c     * terminate with matd=0/ (i.e., a 0/ card).                      *   powr.74   
c     *                                                                *   powr.75   
c     *---for lib=3----------------------------------------------------*   powr.76   
c     *                                                                *   powr.77   
c     * card 3                                                         *   powr.78   
c     *    nlib    number of library.                                  *   powr.79   
c     *    idat    date library is written (i format).                 *   powr.80   
c     *    newmat  number of materials to be added.                    *   powr.81   
c     *    iopt    add option (0=mats will be read in,                 *   powr.82   
c     *                        1=use all mats found on ngendf).        *   powr.83   
c     *    mode    0/1/2=replace isotope(2) in cpmlib/                 *   powr.84   
c     *                   add/create a new library (default=0)         *   powr.85   
c     *    if5     file5 (burnup data) option                          *   powr.86   
c     *            0/1/2=do not process file5 burnup data/             *   powr.87   
c                        process burnup data along with rest of data/  *   powr.88   
c     *                   process burnup data only (default=0)         *   powr.89   
c     *            (default=0)                                         *   powr.90   
c     *    if4     file4 (cross section data) option                   *   powr.91   
c     *            0/1=do not process/process                          *   powr.92   
c     *            (default=1)                                         *   powr.93   
c     * card 4 for iopt=0 only                                         *   powr.94   
c     *    mat     endf mat number of all desired materials.           *   powr.95   
c     *            for materials not on gendf tape, use ident for mat. *   powr.96   
c     *            if mat lt 0, add 100 to output ident                *   powr.97   
c     *            (for second isomer of an isotope)                   *   powr.98   
c     * card 5                                                         *   powr.99   
c     *    nina    nina indicator.                                     *   powr.100  
c     *            0/1/2/3=normal/                                     *   powr.101  
c     *                  no file2 data, calculate absorption in file4/ *   powr.102  
c     *                  no file2 data, read in absorption in file4/   *   powr.103  
c     *                  read in all file2 and file4 data.             *   powr.104  
c     *    ntemp   no. of temperatures to process for this material    *   powr.105  
c     *            (default=0=all found on input tape)                 *   powr.106  
c     *    nsigz   no. of sigma zeroes to process for this material    *   powr.107  
c     *            (default=0=all found on input tape)                 *   powr.108  
c     *    sgref   reference sigma zero                                *   powr.109  
c     *    following 2 parameters are for nina=0 or nina=3.            *   powr.110  
c     *    ires    resonance absorber indicator (0/1=no/yes)           *   powr.111  
c     *    sigp    potential cross section from endf/b.                *   powr.112  
c     *    following 5 parameters are for ntapea=0 only                *   powr.113  
c     *    mti     thermal inelastic mt                                *   powr.114  
c     *    mtc     thermal elastic mt                                  *   powr.115  
c     *    ip1opt  0/1=calculate p1 matrices/                          *   powr.116  
c     *                correct p0 scattering matrix ingroups.          *   powr.117  
c     *  ******if a p1 matrix is calculated for one of the isotopes    *   powr.118  
c     *        having a p1 matrix on the old library, file 6 on the    *   powr.119  
c     *        new library will be completely replaced.******          *   powr.120  
c     *    inorf   0/1=include resonance fission if found/             *   powr.121  
c     *                do not include                                  *   powr.122  
c     *    following two parameters for mode=0 only                    *   powr.123  
c     *    pos     position of this isotope in cpmlib                  *   powr.124  
c     *    posr    (for ires=1) position of this isotope in resonance  *   powr.125  
c     *            tabulation in cpmlib                                *   powr.126  
c     *  repeat card 5 for each nuclide.                               *   powr.127  
c     * following three cards are for if5 gt 0 only                    *   powr.128  
c     * card 6                                                         *   powr.129  
c     *    ntis    no. time-dependent isotopes                         *   powr.130  
c     *    nfis    no. fissionable burnup isotopes                     *   powr.131  
c     * card 7                                                         *   powr.132  
c     *    identb  ident of each of the nfis isotopes                  *   powr.133  
c     * card 8                                                         *   powr.134  
c     *    identa  ident of time-dependent isotope                     *   powr.135  
c     *    decay   decay constant (default=0.)                         *   powr.136  
c     *    yield   nfis yields (default=0.)                            *   powr.137  
c     *  repeat card 8 for each of the ntis isotopes.                  *   powr.138  
c     * card 9 for if5=2 only                                          *   powr.139  
c     *    aw      atomic weight                                       *   powr.140  
c     *    indfis  fission indicator                                   *   powr.141  
c     *    ntemp   no. temperatures on old library                     *   powr.142  
c     *  repeat card 9 for each of the ntis isotopes.                  *   powr.143  
c     * card 10                                                        *   powr.144  
c     *    lambda  resonance group goldstein lambdas                   *   powr.145  
c     *  ******remember that the 69-group structure has 13 resonance   *   powr.146  
c     *        groups while the collapsed 185-group structure has 15.  *   powr.147  
c     *        use a slash at end of each line of card 10 input.****** *   powr.148  
c     *  repeat card 10 for each nuclide having nina=0, nina=3, or     *   powr.149  
c     *                     ires=1.                                    *   powr.150  
c     * cards 11 and 11a for nuclides having nina=3 only.              *   powr.151  
c     * card 11                                                        *   powr.152  
c     *    resnu    nrg nus values to go with the lambda values        *   powr.153  
c     * card 11a                                                       *   powr.154  
c     *    tot      nrg total xsec values to go with the lambda values *   powr.155  
c     *  read cards 11 and 11a for each nuclide having nina=3.         *   powr.156  
c     * cards 12 for nina gt 2 only                                    *   powr.157  
c     *    aw      atomic weight                                       *   powr.158  
c     *    temp    temperature                                         *   powr.159  
c     *    fpa     ngnd absorption values (default=0.)                 *   powr.160  
c     * cards 12a, 12b, 12c for nuclides having nina=3 only.           *   powr.161  
c     * card 12a                                                       *   powr.162  
c     *    nus      ngnd nus values                                    *   powr.163  
c     *    fis      ngnd fission values                                *   powr.164  
c     *    xtr      ngnd transport values                              *   powr.165  
c     * card 12b                                                       *   powr.166  
c     *    ia       group.  0 means no scattering from this group      *   powr.167  
c     *    l1       lowest group to which scattering occurs            *   powr.168  
c     *    l2       highest group to which scattering occurs           *   powr.169  
c     * card 12c  for ia gt 0 only                                     *   powr.170  
c     *    scat     l2-l1+1 scattering values                          *   powr.171  
c     *  repeat card 12b and 12c for each group                        *   powr.172  
c     * repeat cards 12 for each of the nina gt 2 nuclides             *   powr.173  
c     *                                                                *   powr.174  
c     ******************************************************************   powr.175  

WIMSR
      subroutine wimsr                                                    wimsr.3    
c                                                                         wimsr.4    
c     ******************************************************************  wimsr.5    
c     *                                                                *  wimsr.6    
c     * format multigroup cross sections from groupr for wims          *  wimsr.7    
c     *                                                                *  wimsr.8    
c     *---input specifications (free format)---------------------------*  wimsr.9    
c     *                                                                *  wimsr.10   
c     * card 1                                                         *  wimsr.11   
c     *    ngendf  unit for input gendf tape                           *  wimsr.12   
c     *    nout    unit for output wims tape                           *  wimsr.13   
c     *                                                                *  wimsr.14   
c     * card 2                                                         *  wimsr.15   
c     *    iprint  print option                                        *  wimsr.16   
c     *               0=minimum (default)                              *  wimsr.17   
c     *               1=regular                                        *  wimsr.18   
c     *               2=1+intermediate results                         *  wimsr.19   
c     *    iverw   wims version                                        *  wimsr.20   
c     *               4=wims-d (default)                               *  wimsr.21   
c     *               5=wims-e                                         *  wimsr.22   
c     *    igroup  group option                                        *  wimsr.23   
c     *               0=69 groups (default)                            *  wimsr.24   
c     *               9=user's choice                                  *  wimsr.25   
c     *                                                                *  wimsr.26   
c     * card 2a  (igroup.eq.9 only)                                    *  wimsr.27   
c     *    ngnd    number of groups                                    *  wimsr.28   
c     *    nfg     number of fast groups                               *  wimsr.29   
c     *    nrg     number of resonance groups                          *  wimsr.30   
c     *    igref   reference group (default is last fast group)        *  wimsr.31   
c     *                                                                *  wimsr.32   
c     * card 3                                                         *  wimsr.33   
c     *    mat     endf mat number of the material to be processed     *  wimsr.34   
c     *    nfid    not used                                            *  wimsr.35   
c     *    rdfid   identification of material for the wims library     *  wimsr.36   
c     *    iburn   burnup data option                                  *  wimsr.37   
c     *              -1=suppress printout of burnup data               *  wimsr.38   
c     *               0=no burnup data is provided (default)           *  wimsr.39   
c     *               1=burnup data is provided in cards 5 and 6       *  wimsr.40   
c     *                                                                *  wimsr.41   
c     * card  4                                                        *  wimsr.42   
c     *    ntemp   no. of temperatures to process for this material    *  wimsr.43   
c     *            in the thermal energy range                            wimsr.44   
c     *               (0=all found on input tape)                      *  wimsr.45   
c     *    nsigz   no. of sigma zeroes to process for this material    *  wimsr.46   
c     *               (0=all found on input tape)                      *  wimsr.47   
c     *    sgref   reference sigma zero                                *  wimsr.48   
c     *               (.ge. 1.e10 to select all cross sect. at inf.dil.*  wimsr.49   
c     *                           but fully shielded elastic x-sect,   *  wimsr.50   
c     *                .lt. 1.e10 to select all x-sect at inf.dil.     *  wimsr.51   
c     *                =sig0      from the list on groupr input to     *  wimsr.52   
c     *                           select all x-sect. at that sig0)     *  wimsr.53   
c     *    ires    resonance absorber indicator                        *  wimsr.54   
c     *               0=no resonance tables                            *  wimsr.55   
c     *              >0=ires temperatures processed                    *  wimsr.56   
c     *    sigp    potential cross section from endf/b.                *  wimsr.57   
c     *               (if zero, replace by the elastic cross section)  *  wimsr.58   
c     *    mti     thermal inelastic mt (default=0=none)               *  wimsr.59   
c     *    mtc     thermal elastic mt (default=0=none)                 *  wimsr.60   
c     *    ip1opt  include p1 matrices                                 *  wimsr.61   
c     *               0=yes                                            *  wimsr.62   
c     *               1=no, correct p0 ingroups (default)              *  wimsr.63   
c     *    inorf   resonance fission (if found)                        *  wimsr.64   
c     *               0=include resonance fission (default)            *  wimsr.65   
c     *               1=do not include                                 *  wimsr.66   
c     *    isof    fission spectrum                                    *  wimsr.67   
c     *               0=do not include fission spectrum (default)      *  wimsr.68   
c     *               1=include fission spectrum                       *  wimsr.69   
c     *    ifprod  fission product flag                                *  wimsr.70   
c     *               0=not a fission product (default)                *  wimsr.71   
c     *               1=fission product, no resonance tables           *  wimsr.72   
c     *               2=fission product, resonance tables              *  wimsr.73   
c     *    jp1     transport correction neutron current spectrum flag  *  wimsr.74   
c     *               0=use p1-flux for transport correction (default) *  wimsr.75   
c     *              >0=read in jp1 values of the neutron current      *  wimsr.76   
c                       spectrum from input                            *  wimsr.77   
c     *                                                                *  wimsr.78   
c     *   the following cards 5 and 6 are for iburn gt 0 only          *  wimsr.79   
c     * card  5                                                        *  wimsr.80   
c     *    ntis    no. of time-dependent isotopes                      *  wimsr.81   
c     *            for burnable materials ntis=2                       *  wimsr.82   
c     *            for fissile materials ntis>2 when fission product   *  wimsr.83   
c     *            yields are given.                                      wimsr.84   
c     *    efiss   energy released per fission                         *  wimsr.85   
c     *                                                                *  wimsr.86   
c     * card  6a                                                       *  wimsr.87   
c     *    identa  ident of capture product isotope                    *  wimsr.88   
c     *    yield   yield of product identa from capture                *  wimsr.89   
c     *                                                                *  wimsr.90   
c     * card  6b                                                       *  wimsr.91   
c     *    identa  ident of decay product isotope (zero if stable)     *  wimsr.92   
c     *    lambda  decay constant (s-1)                                *  wimsr.93   
c     *                                                                *  wimsr.94   
c     * card  6c  (repeated ntis-2 times, if necessary)                   wimsr.95   
c     *    identa  ident of fission product isotope                    *  wimsr.96   
c     *    yield   fission yield of identa from burnup of mat          *  wimsr.97   
c     *                                                                *  wimsr.98   
c     * card  7                                                        *  wimsr.99   
c     *    lambda  resonance-group goldstein lambdas (13 for           *  wimsr.100  
c     *            default 69-group structure, nrg otherwise).         *  wimsr.101  
c     *                                                                *  wimsr.102  
c     * card  8    (only when jp1>0)                                      wimsr.103  
c     *    p1flx   current spectrum (jp1 entries read, the rest are    *  wimsr.104  
c     *            set with the default p1-flux calculated by njoy).   *  wimsr.105  
c     ******************************************************************  wimsr.106  

PLOTR
      subroutine plotr                                                    plotr.3    
c                                                                         plotr.4    
c     ******************************************************************  plotr.5    
c     *                                                                *  plotr.6    
c     * plot cross sections                                            *  plotr.7    
c     *                                                                *  plotr.8    
c     * handles endf/b data, pendf or gendf data at specified temper-  *  plotr.9    
c     * atures, or experimental input data.  several plots can be      *  plotr.10   
c     * given on each set of axes, with both left and right scales.    *  plotr.11   
c     * also, several graphs can be given on each page or display.     *  plotr.12   
c     * error bars may be included for input data.  flexible titles    *  plotr.13   
c     * and legend blocks are allowed.  all standard combinations of   *  plotr.14   
c     * log and linear axes are supported, either grids or tick marks  *  plotr.15   
c     * can be requested, and scales can be chosen automatically       *  plotr.16   
c     * or set by the user.  in some cases, the x axis is thinned.     *  plotr.17   
c     * in other cases, extra points are added so that, for example,   *  plotr.18   
c     * linear-linear data plots correctly on a log-log graph.         *  plotr.19   
c     * a limited capability for 3-d plots of angle and energy         *  plotr.20   
c     * is included, and the endf-vi file 6 format is supported.       *  plotr.21   
c     * percent difference and ratio plots can be requested.           *   up77.5    
c     * additional guidance for ratio (ntp=3 on card 8) plotting of    *  up280.8    
c     * mf=3 endf or pendf data:                                       *  up280.9    
c     *  - if both cross sections are zero, the ratio is defined to be *  up280.10   
c     *    unity.                                                      *  up280.11   
c     *  - if ntp=3 and mtd=0, then mtd2 is set to zero regardless of  *  up280.12   
c     *    its value on card 8a.                                       *  up280.13   
c     *  - if mtd=0 and y-axis limits (card 6) were specified, then    *  up280.14   
c     *    those limits will apply to all plots.  For selected mt's    *  up280.15   
c     *    both linear-linear and log-linear plots will be produced.   *  up280.16   
c     *  - if mtd=0 and y-axis limits (card 6) are not given, then     *  up280.17   
c     *    y-axis limits are determined internally.  For selected mt's *  up280.18   
c     *    both linear-linear and log-log plots will be produced.      *  up280.19   
c     *                                                                *  plotr.22   
c     * plotr writes plot commands on an output file for later use     *  plotr.23   
c     * by the viewr module or an external graphics program.           *  plotr.24   
c     *                                                                *  plotr.25   
c     *---input--------------------------------------------------------*  plotr.26   
c     *                                                                *  plotr.27   
c     *  card 0                                                        *  plotr.28   
c     *     nplt          unit for output plot commands                *  plotr.29   
c     *     nplt0         unit for input plot commands                 *  plotr.30   
c     *                     default=0=none                             *  plotr.31   
c     *                     output plot commands are appended          *  plotr.32   
c     *                     to the input plot commands, if any.        *  plotr.33   
c     *  card 1                                                        *  plotr.34   
c     *     lori          page orientation (def=1)                     *  plotr.35   
c     *                    0  portrait (7.5x10in)                      *  plotr.36   
c     *                    1  landscape (10x7.5in)                     *  plotr.37   
c     *     istyle        character style (def=2)                      *  plotr.38   
c     *                     1 = roman                                  *  plotr.39   
c     *                     2 = swiss                                  *  plotr.40   
c     *     size          character size option                        *  plotr.41   
c     *                     pos = height in page units                 *  plotr.42   
c     *                     neg = height as fraction of subplot size   *  plotr.43   
c     *                     (default=0.30)                             *  plotr.44   
c     *     ipcol         page color (def=white)                       *  plotr.45   
c     *                    0=white                                     *  plotr.46   
c     *                    1=navajo white                              *  plotr.47   
c     *                    2=blanched almond                           *  plotr.48   
c     *                    3=antique white                             *  plotr.49   
c     *                    4=very pale yellow                          *  plotr.50   
c     *                    5=very pale rose                            *  plotr.51   
c     *                    6=very pale green                           *  plotr.52   
c     *                    7=very pale blue                            *  plotr.53   
c     *                                                                *  plotr.54   
c     * -----repeat cards 2 through 13 for each curve-----             *  plotr.55   
c     *                                                                *  plotr.56   
c     *  card 2                                                        *  plotr.57   
c     *     iplot         plot index                                   *  plotr.58   
c     *                     99 = terminate plotting job                *  plotr.59   
c     *                      1 = new axes, new page                    *  plotr.60   
c     *                     -1 = new axes, existing page               *  plotr.61   
c     *                      n = nth additional plot on existing axes  *  plotr.62   
c     *                     -n = start a new set of curves using       *  plotr.63   
c     *                          the alternate y axis                  *  plotr.64   
c     *                     default = 1                                *  plotr.65   
c     *     iwcol         window color (def=white)                     *  plotr.66   
c     *                    color list same as for ipcol above          *  plotr.67   
c     *     factx         factor for energies (default=1.)             *  plotr.68   
c     *     facty         factor for cross-sections (default=1.)       *  plotr.69   
c     *     xll,yll       lower-left corner of plot area               *  plotr.70   
c     *     ww,wh,wr      window width, height, and rotation angle     *  plotr.71   
c     *                   (plot area defaults to one plot per page)    *  plotr.72   
c     *                                                                *  plotr.73   
c     * -----cards 3 thru 7 for iplot = 1 or -1 only-----              *  plotr.74   
c     *                                                                *  plotr.75   
c     *  card 3                                                        *  plotr.76   
c     *     t1            first line of title                          *  plotr.77   
c     *                   60 characters allowed.                       *  plotr.78   
c     *                   default=none                                 *  plotr.79   
c     *                                                                *  plotr.80   
c     *  card 3a                                                       *  plotr.81   
c     *     t2            second line of title                         *  plotr.82   
c     *                   60 characters allowed.                       *  plotr.83   
c     *                   default=none                                 *  plotr.84   
c     *                                                                *  plotr.85   
c     *  card 4                                                        *  plotr.86   
c     *     itype         type for primary axes                        *  plotr.87   
c     *                     1 = linear x - linear y                    *  plotr.88   
c     *                     2 = linear x - log y                       *  plotr.89   
c     *                     3 = log x - linear y                       *  plotr.90   
c     *                     4 = log x - log y                          *  plotr.91   
c     *                     set negative for 3d axes                   *  plotr.92   
c     *                     default=4                                  *  plotr.93   
c     *     jtype         type for alternate y axis or z axis          *  plotr.94   
c     *                     0 = none                                   *  plotr.95   
c     *                     1 = linear                                 *  plotr.96   
c     *                     2 = log                                    *  plotr.97   
c     *                     default=0                                  *  plotr.98   
c     *     igrid         grid and tic mark control                    *  plotr.99   
c     *                     0 = no grid lines or tic marks             *  plotr.100  
c     *                     1 = grid lines                             *  plotr.101  
c     *                     2 = tic marks on outside                   *  plotr.102  
c     *                     3 = tic marks on inside                    *  plotr.103  
c     *                     default=2                                  *  plotr.104  
c     *     ileg          option to write a legend.                    *  plotr.105  
c     *                     0 = none                                   *  plotr.106  
c     *                     1 = write a legend block with upper left   *  plotr.107  
c     *                         corner at xtag,ytag (see below)        *  plotr.108  
c     *                     2 = use tag labels on each curve with      *  plotr.109  
c     *                         a vector from the tag to the curve     *  plotr.110  
c     *                     default=0                                  *  plotr.111  
c     *     xtag          x coordinate of upper left corner            *  plotr.112  
c     *                   of legend block                              *  plotr.113  
c     *     ytag          y coord of upper left corner                 *  plotr.114  
c     *                   default=upper left corner of plot            *  plotr.115  
c     *                                                                *  plotr.116  
c     *  card 5                                                        *  plotr.117  
c     *     el            lowest energy to be plotted                  *  plotr.118  
c     *     eh            highest energy to be plotted                 *  plotr.119  
c     *     xstep         x axis step                                  *  plotr.120  
c     *                   default = automatic scales                   *  plotr.121  
c     *                   (default all 3, or none)                     *  plotr.122  
c     *                   (the actual value of xstep is                *  plotr.123  
c     *                       ignored for log scales)                  *  plotr.124  
c     *                                                                *  plotr.125  
c     *  card 5a                                                       *  plotr.126  
c     *     xlabl         label for x axis                             *  plotr.127  
c     *                   60 characters allowed.                       *  plotr.128  
c     *                    default="energy (ev)"                       *  plotr.129  
c     *                                                                *  plotr.130  
c     *  card 6                                                        *  plotr.131  
c     *     yl            lowest value of y axis.                      *  plotr.132  
c     *     yh            highest value of y axis.                     *  plotr.133  
c     *     ystep         step for y ayis (linear scales only)         *  plotr.134  
c     *                   default = automatic scales                   *  plotr.135  
c     *                   (default all 3, or none)                     *  plotr.136  
c     *                   (the actual value of ystep is                *  plotr.137  
c     *                       ignored for log scales)                  *  plotr.138  
c     *                                                                *  plotr.139  
c     *  card 6a                                                       *  plotr.140  
c     *     ylabl         label for y axis                             *  plotr.141  
c     *                   60 characters allowed.                       *  plotr.142  
c     *                    default="cross section (barns)"             *  plotr.143  
c     *                                                                *  plotr.144  
c     *  card 7   (jtype.gt.0 only)                                    *  plotr.145  
c     *     rbot          lowest value of secondary y axis or z axis   *  plotr.146  
c     *     rtop          highest value of secondary y axis or z axis  *  plotr.147  
c     *     rstep         step for secondary y axis or z axis          *  plotr.148  
c     *                   default for last three = automatic           *  plotr.149  
c     *                                                                *  plotr.150  
c     *  card 7a  (jtype.gt.0 only)                                    *  plotr.151  
c     *     rl            label for alternate y axis or z axis         *  plotr.152  
c     *                   60 characters allowed.                       *  plotr.153  
c     *                   default=blank                                *  plotr.154  
c     *                                                                *  plotr.155  
c     *  -----cards 8 thru 9 are always given-----                     *  plotr.156  
c     *                                                                *  plotr.157  
c     *  card 8                                                        *  plotr.158  
c     *     iverf         version of endf tape                         *  plotr.159  
c     *                     set to zero for data on input file         *  plotr.160  
c     *                       and ignore rest of parameters on card    *  plotr.161  
c     *                     set to 1 for gendf data                    *  plotr.162  
c     *     nin           input tape                                   *  plotr.163  
c     *                   can change for every curve if desired.       *  plotr.164  
c     *     matd          desired material                             *  plotr.165  
c     *     mfd           desired file                                 *  plotr.166  
c     *     mtd           desired section                              *  plotr.167  
c     *                    mtd=0 means loop over all reactions in mfd  *  plotr.168  
c     *                    (usually one page per mt, but for mf=3,     *  plotr.169  
c     *                    resonance reactions may have several pages) *  plotr.170  
c     *     temper        temperature for endf/b data (k)              *  plotr.171  
c     *                   default=0.                                   *  plotr.172  
c     *     nth,ntp,nkh   see below (defaults=1)                       *  plotr.173  
c     *                                                                *  plotr.174  
c     *       special meanings for nth,ntp,nkh for file 3 or 5 data    *  plotr.175  
c     *            nth   number of subsection to plot                  *  plotr.176  
c     *              (works for isomer prod, delayed n, etc.)          *  plotr.177  
c     *            ntp   special features                              *   up77.7    
c     *                  1 for regular plots (default)                 *   up77.8    
c     *                  2 for percent difference plots                *   up77.9    
c     *                     read a second "card 8" for percent diff    *   up77.10   
c     *                     of second curve with respect to first      *   up77.11   
c     *                  3 for ratio plots                             *   up77.12   
c     *                     read a second "card 8" for ratio           *   up77.13   
c     *                     of second curve to first                   *   up77.14   
c     *            nkh   not used                                      *  plotr.179  
c     *                                                                *  plotr.180  
c     *       special meanings for nth,ntp,nkh for file 6 data         *  plotr.181  
c     *            nth   index for  incident energy                    *  plotr.182  
c     *            ntp   number of dep. variable in cyle to plot       *  plotr.183  
c     *                  (or angle number for law 7)                   *  plotr.184  
c     *            nkh   number of outgoing particle to plot           *  plotr.185  
c     *                                                                *  plotr.186  
c     *       special meanings for nth,ntp,nkh for gendf mf=3 data     *  plotr.187  
c     *            nth=0 for flux per unit lethargy                    *  plotr.188  
c     *            nth=1 for cross section (default)                   *  plotr.189  
c     *            ntp=1 for infinite dilution (default)               *  plotr.190  
c     *            ntp=2 for next lowest sigma-zero values, etc.       *  plotr.191  
c     *                  set ntp negative for self shieldin factor        up350.5    
c     *            nkh=1 for p0 weighting (default)                    *  plotr.192  
c     *            nkh=2 for p1 weighting (total only)                 *  plotr.193  
c                                                                         plotr.194  
c     *       special meaning for nth for gendf mf=6 data              *  plotr.195  
c     *            nth=1 plot 2-d spectrum for group 1                 *  plotr.196  
c     *            nth=2 plot 2-d spectrum for group 2                 *  plotr.197  
c     *              etc.                                              *  plotr.198  
c     *        no special flags are needed for mf=6 3d plots           *  plotr.199  
c     *                                                                *  plotr.200  
c     *      special meanings for nth and ntp for mf7 plots            *  plotr.201  
c     *           nth is index for indep. variable (alpha or beta)     *  plotr.202  
c     *           ntp=1 selects alpha as indep. variable (default)     *  plotr.203  
c     *           ntp=2 selects beta as indep. variable                *  plotr.204  
c     *           nkh=1 selects normal s(alpha,beta)                   *  plotr.205  
c     *           nkh=2 selects script s(alpha,-beta)                  *  plotr.206  
c     *           nkh=3 selects script s(alpha,beta)                   *  plotr.207  
c     *                                                                *  plotr.208  
c     * -----cards 9 and 10 for 2d plots only-----                     *  plotr.209  
c     *                                                                *  plotr.210  
c     *  card 9                                                        *  plotr.211  
c     *     icon          symbol and connection option                 *  plotr.212  
c     *                     0 = points connected, no symbols           *  plotr.213  
c     *                    -i = points not connected, symbol at every  *  plotr.214  
c     *                         ith point                              *  plotr.215  
c     *                     i = points connected, symbol at every ith  *  plotr.216  
c     *                         points                                 *  plotr.217  
c     *                     default=0                                  *  plotr.218  
c     *     isym          no. of symbol to be used                     *  plotr.219  
c     *                     0 = square                                 *  plotr.220  
c     *                     1 = octagon                                *  plotr.221  
c     *                     2 = triangle                               *  plotr.222  
c     *                     3 = cross                                  *  plotr.223  
c     *                     4 = ex                                     *  plotr.224  
c     *                     5 = diamond                                *  plotr.225  
c     *                     6 = inverted triangle                      *  plotr.226  
c     *                     7 = exed square                            *  plotr.227  
c     *                     8 = crossed ex                             *  plotr.228  
c     *                     9 = crossed diamond                        *  plotr.229  
c     *                     10 = crossed octagon                       *  plotr.230  
c     *                     11 = double triangle                       *  plotr.231  
c     *                     12 = crossed square                        *  plotr.232  
c     *                     13 = exed octagon                          *  plotr.233  
c     *                     14 = triangle and square                   *  plotr.234  
c     *                     15 = filled circle                         *  plotr.235  
c     *                     16 = open circle                           *  plotr.236  
c     *                     17 = open square                           *  plotr.237  
c     *                     18 = filled square                         *  plotr.238  
c     *                     default=0                                  *  plotr.239  
c     *     idash         type of line to plot                         *  plotr.240  
c     *                     0 = solid                                  *  plotr.241  
c     *                     1 = dashed                                 *  plotr.242  
c     *                     2 = chain dash                             *  plotr.243  
c     *                     3 = chain dot                              *  plotr.244  
c     *                     4 = dot                                    *  plotr.245  
c     *                     default=0                                  *  plotr.246  
c     *     iccol         curve color (def=black)                      *  plotr.247  
c     *                     0=black                                    *  plotr.248  
c     *                     1=red                                      *  plotr.249  
c     *                     2=green                                    *  plotr.250  
c     *                     3=blue                                     *  plotr.251  
c     *                     4=magenta                                  *  plotr.252  
c     *                     5=cyan                                     *  plotr.253  
c     *                     6=brown                                    *  plotr.254  
c     *                     7=purple                                   *  plotr.255  
c     *     ithick        thickness of curve (def=1)                   *  plotr.256  
c     *                     0 = invisible (for shaded areas)           *  plotr.257  
c     *     ishade        shade pattern                                *  plotr.258  
c     *                     0 = none                                   *  plotr.259  
c     *                     1 to 10 = 10% to 100% gray                 *  plotr.260  
c     *                     11 to 20 = 45 deg right hatching           *  plotr.261  
c     *                     21 to 30 = 45 deg left hatching            *  plotr.262  
c     *                     31 to 40 = 45 deg cross hatching           *  plotr.263  
c     *                     41 to 50 = shades of green                 *  plotr.264  
c     *                     51 to 60 = shades of red                   *  plotr.265  
c     *                     61 to 70 = shades of brown                 *  plotr.266  
c     *                     71 to 80 = shades of blue                  *  plotr.267  
c     *                     default=0                                  *  plotr.268  
c     *                                                                *  plotr.269  
c     *  card 10  ---ileg.ne.0 only---                                 *  plotr.270  
c     *     aleg          title for curve tag or legend block          *  plotr.271  
c     *                   60 characters allowed.                       *  plotr.272  
c     *                   default=blank                                *  plotr.273  
c     *                                                                *  plotr.274  
c     *  card 10a  ---ileg.eq.2 only---                                *  plotr.275  
c     *     xtag          x position of tag title                      *  plotr.276  
c     *     ytag          y position of tag title                      *  plotr.277  
c     *     xpoint        x coordinate of vector point                 *  plotr.278  
c     *                    (.le.0 to omit vector)                      *  plotr.279  
c     *                                                                *  plotr.280  
c     * -----card 11 for 3d plots only-----                            *  plotr.281  
c     *                                                                *  plotr.282  
c     *  card 11                                                       *  plotr.283  
c     *     xv,yv,zv      abs. coords of view point                    *  plotr.284  
c     *                   defaults=15.,-15.,15.                        *  plotr.285  
c     *     x3,y3,z3      abs. sides of work box volume                *  plotr.286  
c     *                   defaults=2.5,6.5,2.5                         *  plotr.287  
c     *                                                                *  plotr.288  
c     *         set x3 or y3 negative to flip the order of the         *  plotr.289  
c     *         axis on that side of the work box.                     *  plotr.290  
c     *                                                                *  plotr.291  
c     *  -----cards 12 thru 13 for iverf = 0 only-----                 *  plotr.292  
c     *                                                                *  plotr.293  
c     *  card 12                                                       *  plotr.294  
c     *     nform          format code for input data                  *  plotr.295  
c     *                    0 = free format input with                  *  plotr.296  
c     *                    optional x and y error bars                 *  plotr.297  
c     *                                                                *  plotr.298  
c     *  card 13   ---nform = 0 only---                                *  plotr.299  
c     *     xdata          dependent value                             *  plotr.300  
c     *                    terminate with empty card (/)               *  plotr.301  
c     *     ydata          independent value                           *  plotr.302  
c     *     yerr1          lower y error limit                         *  plotr.303  
c     *                    no y error bar if zero                      *  plotr.304  
c     *     yerr2          upper y error limit                         *  plotr.305  
c     *                    if zero, equals yerr1                       *  plotr.306  
c     *     xerr1          x left error limit                          *  plotr.307  
c     *                    no x error bar if zero                      *  plotr.308  
c     *     xerr2          x right error limit                         *  plotr.309  
c     *                    if zero, equals xerr1                       *  plotr.310  
c     *                                                                *  plotr.311  
c     *                                                                *  plotr.312  
c     * all curves contain at least 10 points per decade (see delta).  *  plotr.313  
c     * code can plot curves containing fewer than 2000 points (see    *  plotr.314  
c     * max) without thinning.  curves with more points are thinned    *  plotr.315  
c     * based on a minimum spacing determined from max and the         *  plotr.316  
c     * length of the x axis.                                          *  plotr.317  
c     *                                                                *  plotr.318  
c     ******************************************************************  plotr.319  

VIEWR
      subroutine viewr                                                    viewr.3    
c                                                                         viewr.4    
c     ******************************************************************  viewr.5    
c     *                                                                *  viewr.6    
c     * view plots generated by plotr, covr, or dtfr.                  *  viewr.7    
c     * postscript version                                             *  viewr.8    
c     *                                                                *  viewr.9    
c     * character specifications are similar to disspla, except that   *  viewr.10   
c     * the default case is lower instead of upper.  this allows       *  viewr.11   
c     * mixed-case strings to be used in postscript mode.  the         *  viewr.12   
c     * following shift characters are used:                           *  viewr.13   
c     *     < = upper-case standard                                    *  viewr.14   
c     *     > = lower-case or mixed-case standard                      *  viewr.15   
c     *     [ = upper-case greek                                       *  viewr.16   
c     *     ] = lower-case or mixed-case greek                         *  viewr.17   
c     *     # = instructions                                           *  viewr.18   
c     * give one of the shift characters twice to get it instead of    *  viewr.19   
c     * its action.  the following instructions are supported:         *  viewr.20   
c     *     Ev = elevate by v as a fraction of the height              *  viewr.21   
c     *           if v is missing or D is given, use .5                *  viewr.22   
c     *     Lv = lower by v as a fraction of the height                *  viewr.23   
c     *           if v is missing or D is given, use .5                *  viewr.24   
c     *     Hv = change height by v as a fraction of the height        *  viewr.25   
c     *           if v is missing or D is given, use .5                *  viewr.26   
c     *     Fi = change to font number i                               *  viewr.27   
c     *     Mi = change mode number, where mode 0 is the lower 128     *  viewr.28   
c     *           postscript characters and mode 1 is the upper 128    *  viewr.29   
c     *     X  = reset E, L, or H.  Font and Mode must be              *  viewr.30   
c     *           reset explicitly.                                    *  viewr.31   
c     *     c is a real number, i is an integer.                       *  viewr.32   
c     *                                                                *  viewr.33   
c     *---input--------------------------------------------------------*  viewr.34   
c     *                                                                *  viewr.35   
c     *  card 1                                                        *  viewr.36   
c     *     infile        input file                                   *  viewr.37   
c     *     nps           postscript output file                       *  viewr.38   
c     *                                                                *  viewr.39   
c     *---data file format---------------------------------------------*  viewr.40   
c     *                                                                *  viewr.41   
c     *  card 1                                                        *  viewr.42   
c     *     lori          page orientation (def=1)                     *  viewr.43   
c     *                    0  portrait (7.5x10in)                      *  viewr.44   
c     *                    1  landscape (10x7.5in)                     *  viewr.45   
c     *     istyle        character style (def=2)                      *  viewr.46   
c     *                     1  roman                                   *  viewr.47   
c     *                     2  swiss                                   *  viewr.48   
c     *     size          character size option                        *  viewr.49   
c     *                     pos = height in page units                 *  viewr.50   
c     *                     neg = height as fraction of subplot size   *  viewr.51   
c     *                       (default=.30)                            *  viewr.52   
c     *     ipcol         page color (def=white)                       *  viewr.53   
c     *                    0=white                                     *  viewr.54   
c     *                    1=navajo white                              *  viewr.55   
c     *                    2=blanched almond                           *  viewr.56   
c     *                    3=antique white                             *  viewr.57   
c     *                    4=very pale yellow                          *  viewr.58   
c     *                    5=very pale rose                            *  viewr.59   
c     *                    6=very pale green                           *  viewr.60   
c     *                    7=very pale blue                            *  viewr.61   
c     *                                                                *  viewr.62   
c     * -----repeat cards 2 through 13 for each curve-----             *  viewr.63   
c     *                                                                *  viewr.64   
c     *  card 2                                                        *  viewr.65   
c     *     iplot         plot index                                   *  viewr.66   
c     *                     99 = terminate plotting job                *  viewr.67   
c     *                      1 = new axes, new page                    *  viewr.68   
c     *                     -1 = new axes, existing page               *  viewr.69   
c     *                      n = nth additional plot on existing axes  *  viewr.70   
c     *                     -n = start a new set of curves using       *  viewr.71   
c     *                          the alternate y axis                  *  viewr.72   
c     *                     default = 1                                *  viewr.73   
c     *     iwcol         window color (def=white)                     *  viewr.74   
c     *                    color list same as for ipcol above          *  viewr.75   
c     *     factx         factor for energies (default=1.)             *  viewr.76   
c     *     facty         factor for cross-sections (default=1.)       *  viewr.77   
c     *     xll,yll       lower-left corner of plot area               *  viewr.78   
c     *     ww,wh,wr      window width, height, and rotation angle     *  viewr.79   
c     *                   (plot area defaults to one plot per page)    *  viewr.80   
c     *                                                                *  viewr.81   
c     * -----cards 3 thru 7 for iplot = 1 or -1 only-----              *  viewr.82   
c     *                                                                *  viewr.83   
c     *  card 3                                                        *  viewr.84   
c     *     t1            first line of title                          *  viewr.85   
c     *                   80 characters allowed.                       *  up274.6    
c     *                   default=none                                 *  viewr.87   
c     *                                                                *  viewr.88   
c     *  card 3a                                                       *  viewr.89   
c     *     t2            second line of title                         *  viewr.90   
c     *                   80 characters allowed.                       *  up274.8    
c     *                   default=none                                 *  viewr.92   
c     *                                                                *  viewr.93   
c     *  card 4                                                        *  viewr.94   
c     *     itype         type for primary axes                        *  viewr.95   
c     *                     1 = linear x - linear y                    *  viewr.96   
c     *                     2 = linear x - log y                       *  viewr.97   
c     *                     3 = log x - linear y                       *  viewr.98   
c     *                     4 = log x - log y                          *  viewr.99   
c     *                     set negative for 3d axes                   *  viewr.100  
c     *                     0 = no plot, titles only                   *  viewr.101  
c     *                     default=4                                  *  viewr.102  
c     *     jtype         type for alternate y axis or z axis          *  viewr.103  
c     *                     0 = none                                   *  viewr.104  
c     *                     1 = linear                                 *  viewr.105  
c     *                     2 = log                                    *  viewr.106  
c     *                     default=0                                  *  viewr.107  
c     *     igrid         grid and tic mark control                    *  viewr.108  
c     *                     0 = no grid lines or tic marks             *  viewr.109  
c     *                     1 = grid lines                             *  viewr.110  
c     *                     2 = tic marks on outside                   *  viewr.111  
c     *                     3 = tic marks on inside                    *  viewr.112  
c     *                     default=2                                  *  viewr.113  
c     *     ileg          option to write a legend.                    *  viewr.114  
c     *                     0 = none                                   *  viewr.115  
c     *                     1 = write a legend block with upper left   *  viewr.116  
c     *                         corner at xtag,ytag (see below)        *  viewr.117  
c     *                     2 = use tag labels on each curve with      *  viewr.118  
c     *                         a vector from the tag to the curve     *  viewr.119  
c     *                     default=0                                  *  viewr.120  
c     *     xtag          x coordinate of upper left corner            *  viewr.121  
c     *                   of legend block                              *  viewr.122  
c     *     ytag          y coord of upper left corner                 *  viewr.123  
c     *                   default=upper left corner of plot            *  viewr.124  
c     *                                                                *  viewr.125  
c     *  card 5                                                        *  viewr.126  
c     *     xmin          lowest energy to be plotted                  *  viewr.127  
c     *     xmax          highest energy to be plotted                 *  viewr.128  
c     *     xstep         x axis step                                  *  viewr.129  
c     *                   default = automatic scales                   *  viewr.130  
c     *                   (for linear, give all 3, or none)            *  viewr.131  
c     *                   (for log, give first 2, or none)             *  viewr.132  
c     *                                                                *  viewr.133  
c     *  card 5a                                                       *  viewr.134  
c     *     xlabl         label for x axis                             *  viewr.135  
c     *                   80 characters allowed.                       *  up274.10   
c     *                   (default = no label, no numbering)           *  viewr.137  
c     *                                                                *  viewr.138  
c     *  card 6                                                        *  viewr.139  
c     *     ymin          lowest value of y axis.                      *  viewr.140  
c     *     ymax          highest value of y axis.                     *  viewr.141  
c     *     ystep         step for y ayis (linear scales only)         *  viewr.142  
c     *                   default = automatic scales                   *  viewr.143  
c     *                   (for linear, give all 3, or none)            *  viewr.144  
c     *                   (for log, give first 2, or none)             *  viewr.145  
c     *                                                                *  viewr.146  
c     *  card 6a                                                       *  viewr.147  
c     *     ylabl         label for y axis                             *  viewr.148  
c     *                   80 characters allowed.                       *  up274.12   
c     *                   (default = no label, no numbering)           *  viewr.150  
c     *                                                                *  viewr.151  
c     *  card 7   (jtype.gt.0 only)                                    *  viewr.152  
c     *     rmin          lowest value of secondary y axis or z axis   *  viewr.153  
c     *     rmax          highest value of secondary y axis or z axis  *  viewr.154  
c     *     rstep         step for secondary y axis or z axis          *  viewr.155  
c     *                   (default = automatic scale)                  *  viewr.156  
c     *                   (for linear, give all 3, or none)            *  viewr.157  
c     *                   (for log, give first 2, or none)             *  viewr.158  
c     *                                                                *  viewr.159  
c     *  card 7a  (jtype.gt.0 only)                                    *  viewr.160  
c     *     rl            label for alternate y axis or z axis         *  viewr.161  
c     *                   80 characters allowed.                       *  up274.14   
c     *                   (default = no label, no numbering)           *  viewr.163  
c     *                                                                *  viewr.164  
c     *   card 8  -- dummy input card for consistency with plotr       *  viewr.165  
c     *               it always should be 0/                           *  viewr.166  
c     *                                                                *  viewr.167  
c     * -----cards 9 and 10 for 2d plots only-----                     *  viewr.168  
c     *                                                                *  viewr.169  
c     *   card 9                                                       *  viewr.170  
c     *     icon          symbol and connection option                 *  viewr.171  
c     *                     0 = points connected, no symbols           *  viewr.172  
c     *                    -i = points not connected, symbol at every  *  viewr.173  
c     *                         ith point                              *  viewr.174  
c     *                     i = points connected, symbol at every ith  *  viewr.175  
c     *                         points                                 *  viewr.176  
c     *                     default=0                                  *  viewr.177  
c     *     isym          no. of symbol to be used                     *  viewr.178  
c     *                     0 = square                                 *  viewr.179  
c     *                     1 = octagon                                *  viewr.180  
c     *                     2 = triangle                               *  viewr.181  
c     *                     3 = cross                                  *  viewr.182  
c     *                     4 = ex                                     *  viewr.183  
c     *                     5 = diamond                                *  viewr.184  
c     *                     6 = inverted triangle                      *  viewr.185  
c     *                     7 = exed square                            *  viewr.186  
c     *                     8 = crossed ex                             *  viewr.187  
c     *                     9 = crossed diamond                        *  viewr.188  
c     *                     10 = crossed octagon                       *  viewr.189  
c     *                     11 = double triangle                       *  viewr.190  
c     *                     12 = crossed square                        *  viewr.191  
c     *                     13 = exed octagon                          *  viewr.192  
c     *                     14 = triangle and square                   *  viewr.193  
c     *                     15 = filled circle                         *  viewr.194  
c     *                     16 = open circle                           *  viewr.195  
c     *                     17 = open square                           *  viewr.196  
c     *                     18 = filled square                         *  viewr.197  
c     *                     19 = filled diamond                        *  viewr.198  
c     *                     20 = filled triangle                       *  viewr.199  
c     *                     21 = filled inverted triangle              *  viewr.200  
c     *                     22 = crossed circle                        *  viewr.201  
c     *                     23 = exed circle                           *  viewr.202  
c     *                     24 = exed diamond                          *  viewr.203  
c     *                     default=0                                  *  viewr.204  
c     *     idash         type of line to plot                         *  viewr.205  
c     *                     0 = solid                                  *  viewr.206  
c     *                     1 = dashed                                 *  viewr.207  
c     *                     2 = chain dash                             *  viewr.208  
c     *                     3 = chain dot                              *  viewr.209  
c     *                     4 = dot                                    *  viewr.210  
c     *                     5 = invisible                              *  viewr.211  
c     *                     default=0                                  *  viewr.212  
c     *     iccol         curve color (def=black)                      *  viewr.213  
c     *                     0=black                                    *  viewr.214  
c     *                     1=red                                      *  viewr.215  
c     *                     2=green                                    *  viewr.216  
c     *                     3=blue                                     *  viewr.217  
c     *                     4=magenta                                  *  viewr.218  
c     *                     5=cyan                                     *  viewr.219  
c     *                     6=brown                                    *  viewr.220  
c     *                     7=purple                                   *  up250.7    
c     *                     8=orange                                   *  up250.8    
c     *     ithick        controls thickness of curve                  *  viewr.222  
c     *                     0 = invisible (for shaded areas)           *  viewr.223  
c     *                     (default=1)                                *  viewr.224  
c     *     ishade        shade pattern                                *  viewr.225  
c     *                     0 = none                                   *  viewr.226  
c     *                     1 to 10 = 10% to 100% gray                 *  viewr.227  
c     *                     11 to 20 = 45 deg right hatching           *  viewr.228  
c     *                     21 to 30 = 45 deg left hatching            *  viewr.229  
c     *                     31 to 40 = 45 deg cross hatching           *  viewr.230  
c     *                     41 to 50 = shades of green                 *  viewr.231  
c     *                     51 to 60 = shades of red                   *  viewr.232  
c     *                     61 to 70 = shades of brown                 *  viewr.233  
c     *                     71 to 80 = shades of blue                  *  viewr.234  
c     *                     default=0                                  *  viewr.235  
c     *                                                                *  viewr.236  
c     *   card 10   ---ileg.ne.0 only---                               *  viewr.237  
c     *     aleg          title for curve tag or legend block          *  viewr.238  
c     *                   80 characters allowed.                       *  up274.16   
c     *                   default=blank                                *  viewr.240  
c     *                                                                *  viewr.241  
c     *   card 10a  ---ileg.eq.2 only---                               *  viewr.242  
c     *     xtag          x position of tag title                      *  viewr.243  
c     *     ytag          y position of tag title                      *  viewr.244  
c     *     xpoint        x coordinate of vector point                 *  viewr.245  
c     *                    (.le.0 to omit vector)                      *  viewr.246  
c     *                                                                *  viewr.247  
c     * -----card 11 for 3d plots only-----                            *  viewr.248  
c     *                                                                *  viewr.249  
c     *   card 11                                                      *  viewr.250  
c     *     xv,yv,zv      abs. coords of view point                    *  viewr.251  
c     *                   defaults= 15.,-15.,15.                       *  viewr.252  
c     *     x3,y3,z3      abs. sides of work box volume                *  viewr.253  
c     *                   defaults=2.5,6.5,2.5                         *  viewr.254  
c     *                                                                *  viewr.255  
c     *          set x3 negative to flip the order of the axis on      *  viewr.256  
c     *          that side of the box (secondary energy, cosine).      *  viewr.257  
c     *                                                                *  viewr.258  
c     *   card 12                                                      *  viewr.259  
c     *     nform          format code for input data                  *  viewr.260  
c     *                    0 = free format input with                  *  viewr.261  
c     *                        optional x and y error bars             *  viewr.262  
c     *                    1 = free format input for a                 *  viewr.263  
c     *                        3d family of curves z(x) vs y           *  viewr.264  
c     *                                                                *  viewr.265  
c     *   card 13   ---nform = 0 only---   2-d data                    *  viewr.266  
c     *     xdata          independent value                           *  viewr.267  
c     *                    terminate with empty card (/)               *  viewr.268  
c     *     ydata          dependent value                             *  viewr.269  
c     *     yerr1          lower y error limit                         *  viewr.270  
c     *                    no y error bar if zero                      *  viewr.271  
c     *     yerr2          upper y error limit                         *  viewr.272  
c     *                    if zero, equals yerr1                       *  viewr.273  
c     *     xerr1          x left error limit                          *  viewr.274  
c     *                    no x error bar if zero                      *  viewr.275  
c     *     xerr2          x right error limit                         *  viewr.276  
c     *                    if zero, equals xerr1                       *  viewr.277  
c     *                                                                *  viewr.278  
c     *   card 14   ---nform = 1 only---   3-d data                    *  viewr.279  
c     *     y              y value for curve                           *  viewr.280  
c     *                    repeat cards 13 and 13a for each curve      *  viewr.281  
c     *                    terminate with empty card (/)               *  viewr.282  
c     *                                                                *  viewr.283  
c     *   card14a   ---nform = 1 only---                               *  viewr.284  
c     *     x              x value                                     *  viewr.285  
c     *     z              z value                                     *  viewr.286  
c     *                    repeat card 13a for each point in curve     *  viewr.287  
c     *                    terminate with empty card (/)               *  viewr.288  
c     *                    disspla version requires same x grid        *  viewr.289  
c     *                    for each value of y.                        *  viewr.290  
c     *                                                                *  viewr.291  
c     ******************************************************************  viewr.292  

MIXR
      subroutine mixr                                                      mixr.3    
c                                                                          mixr.4    
c     ******************************************************************   mixr.5    
c     *                                                                *   mixr.6    
c     *  mixr                                                          *   mixr.7    
c     *                                                                *   mixr.8    
c     *  construct a new pendf tape with a specified set of            *   mixr.9    
c     *  reactions that are specified linear combinations of the       *   mixr.10   
c     *  cross sections from the input tapes.  mixr can also be        *   mixr.11   
c     *  used for endf tapes, but the input interpolation laws         *   mixr.12   
c     *  are ignored.  this module can be used to construct mixed      *   mixr.13   
c     *  reactions for plotting (for example, elemental cross          *   mixr.14   
c     *  sections).  the output file contains files 1 and 3 only.      *   mixr.15   
c     *  linear-linear interpolation is assumed.                       *   mixr.16   
c     *                                                                *   mixr.17   
c     *  user input --                                                 *   mixr.18   
c     *                                                                *   mixr.19   
c     *  card 1  --  units                                             *   mixr.20   
c     *     nout      output unit for mixed cross sections             *   mixr.21   
c     *     nin1      first input unit (endf or pendf)                 *   mixr.22   
c     *     nin2      second input unit                                *   mixr.23   
c     *      ...       continue for nnin<=10 input units               *   mixr.24   
c     *                                                                *   mixr.25   
c     *  card 2  --  reaction list                                     *   mixr.26   
c     *      mtn       list of nmt<=20 mt numbers for                  *   mixr.27   
c     *                   the output reactions                         *   mixr.28   
c     *                                                                *   mixr.29   
c     *  card 3  --  material list                                     *   mixr.30   
c     *     matn,     list of nmat<=10 pairs (matn,wtn) of mat         *   mixr.31   
c     *      wtn       numbers and associated weight factors           *   mixr.32   
c     *                                                                *   mixr.33   
c     *  card 4  --  temperature                                       *   mixr.34   
c     *     temp      temperature (use zero except for pendf tapes)    *   mixr.35   
c     *                                                                *   mixr.36   
c     *  card 5  --  output material                                   *   mixr.37   
c     *     matd      material number                                  *   mixr.38   
c     *     za        za value                                         *   mixr.39   
c     *     awr       awr value                                        *   mixr.40   
c     *                                                                *   mixr.41   
c     *  card 6  --  file 1 comment card                               *   mixr.42   
c     *     des      description (60 char max)                         *   mixr.43   
c     *                                                                *   mixr.44   
c     ******************************************************************   mixr.45   

PURR
      subroutine purr                                                      purr.3    
c                                                                          purr.4    
c     ******************************************************************   purr.5    
c     *                                                                *   purr.6    
c     * probabalistic unresolved calculation                           *   purr.7    
c     * bondarenko moments and probability tables                      *   purr.8    
c     *                                                                *   purr.9    
c     ******************************************************************   purr.10   
c     *                                                                *   purr.11   
c     *  purr constructs a series of resonance ladders that obey the   *   purr.12   
c     *  distributions given in mt151 of the endf tape.  each ladder   *   purr.13   
c     *  is sampled randomly to produce contributions to a probability *   purr.14   
c     *  table and a set of bondarenko moments.  when the table is     *   purr.15   
c     *  complete, bondarenko moments are computed from the table to   *   purr.16   
c     *  provide a convergence check.  all temperatures are computed   *   purr.17   
c     *  simultaneously to preserve temperature correlations.  the     *   purr.18   
c     *  bondarenko tables are written on the pendf tape using mt152,  *   purr.19   
c     *  and the probability tables are written using mt153.           *   purr.20   
c     *  a conditional probability for heating is added to the table.  *   purr.21   
c     *  if partial heating cross sections for elastic (302), fission  *   purr.22   
c     *  (318), and capture (402) are available from heatr, full       *   purr.23   
c     *  fluctuations will be provided for the total heating.          *   purr.24   
c     *  otherwise, the same value will be provided for each bin.      *   purr.25   
c     *                                                                *   purr.26   
c     *---input data cards---------------------------------------------*   purr.27   
c     *                                                                *   purr.28   
c     * card 1                                                         *   purr.29   
c     *   nendf   unit for endf/b tape                                 *   purr.30   
c     *   nin     unit for input pendf tape                            *   purr.31   
c     *   nout    unit for output pendf tape                           *   purr.32   
c     * card 2                                                         *   purr.33   
c     *   matd    material to be processed                             *   purr.34   
c     *           matd=0 terminates purr                               *   purr.35   
c     *   ntemp   no. of temperatures (10 max)                         *   purr.36   
c     *   nsigz   no of sigma zeros (10 max)                           *   purr.37   
c     *   nbin    no. of probability bins (15 or more)                    up296.51   
c     *   nladr   no. of resonance ladders                             *   purr.39   
c     *   iprint  print option (0=min, 1=max, def=1)                   *   purr.40   
c     *   nunx    no. of energy points desired (def=0=all)             *   purr.41   
c     * card 3                                                         *   purr.42   
c     *   temp    temperatures in kelvin (including zero)              *   purr.43   
c     * card 4                                                         *   purr.44   
c     *   sigz    sigma zero values (including infinity)               *   purr.45   
c     *                                                                *   purr.46   
c     ******************************************************************   purr.47   

LEAPR
      subroutine leapr                                                    leapr.3    
c                                                                         leapr.4    
c     ******************************************************************  leapr.5    
c     *                                                                *  leapr.6    
c     * calculate s(alpha,beta)                                        *  leapr.7    
c     *                                                                *  leapr.8    
c     * calculates the thermal scattering law, s(alpha,beta), in the   *  leapr.9    
c     * incoherent and gaussian approximations.  the scattering law    *  leapr.10   
c     * for solid-type frequency distributions is calculated using     *  leapr.11   
c     * the phonon expansion method without recourse to the usual      *  leapr.12   
c     * edgewood and sct approximations.  if desired, an analytic      *  leapr.13   
c     * representation of diffusion or free-gas scattering can be      *  leapr.14   
c     * convolved with the solid-type scattering law.  in addition,    *  leapr.15   
c     * up to 50 discrete oscillators can be convolved with the        *  leapr.16   
c     * continuous scattering law.  the results of the calculation     *  leapr.17   
c     * are written out in endf6 file 7 format, ready to be            *  leapr.18   
c     * processed by the thermr module of njoy.                        *  leapr.19   
c     *                                                                *  leapr.20   
c     * it is possible to generate s(alpha,beta) for composite         *  leapr.21   
c     * moderators like beo, where be in beo is combined with o in     *  leapr.22   
c     * beo and normalized to be used with the be cross section.       *  leapr.23   
c     *                                                                *  leapr.24   
c     * incoherent elastic or coherent elastic scattering functions    *  leapr.25   
c     * can also be included using the endf6 format.  the incoherent   *  leapr.26   
c     * result depends on the debye-waller factor computed during the  *  leapr.27   
c     * s(alpha,beta) calculation.  the coherent result is computed    *  leapr.28   
c     * using the methods developed for the thermr module of njoy      *  leapr.29   
c     * (which were based on the hexscat code).  this scattering       *  leapr.30   
c     * law depends on the debye-waller factor from the s(alpha,beta)  *  leapr.31   
c     * calculation, on lattice parameters that are built in to data   *  leapr.32   
c     * statements in the code, and on the coherent scattering cross   *  leapr.33   
c     * section (which is also built in).                              *  leapr.34   
c     *                                                                *  leapr.35   
c     * a special option exists for liquid hydrogen and deuterium.     *  leapr.36   
c     * a solid-type spectrum and a diffusive spectrum can be given    *  leapr.37   
c     * in the normal way.  the resulting s(alpha,beta) is then        *  leapr.38   
c     * convolved with rotational modes calculated using the method    *  leapr.39   
c     * of young and koppel.  because of the inclusion of spin         *  leapr.40   
c     * correlations, the resulting s(alpha,beta) is not symmetric in  *  leapr.41   
c     * beta, and the lasym option is used in mf7.                     *  leapr.42   
c     *                                                                *  leapr.43   
c     * this module is loosly based on the british code 'leap+addelt', *  leapr.44   
c     * originally written by r.c.f.mclatchie at harwell (1962,        *  leapr.45   
c     * unpublished), then implemented by a.t.d.butland at winfrith    *  leapr.46   
c     * (aeew 1200, 1973), and finally modified to work better for     *  leapr.47   
c     * cold moderators as part of the thesis of d.j.picton, now       *  leapr.48   
c     * at the university of birmingham.  the first endf and njoy      *  leapr.49   
c     * compatible version was prepared by r.e.macfarlane at           *  leapr.50   
c     * los alamos in 1987.  the main changes to the original code     *  leapr.51   
c     * were: 1) the change to njoy style, 2) the addition of endf6    *  leapr.52   
c     * output, 3) the addition of incoherent elastic output, 4) the   *  leapr.53   
c     * addition of a coherent elastic calculation, 5) a major         *  leapr.54   
c     * speed up of the diffusion calculation by using interpolation   *  leapr.55   
c     * instead of direct recalculation of s-solid(alpha,beta),        *  leapr.56   
c     * and 6) the liquid hydrogen and deuterium treatments.           *  leapr.57   
c     * a second version was prepared by r.e.macfarlane in 1989 by     *  leapr.58   
c     * removing the edgewood and sct approximations in favor of       *  leapr.59   
c     * direct use of the phonon expansion for all phonon orders.      *  leapr.60   
c     * in addition, free gas scattering was added, the code was       *  leapr.61   
c     * simplified and scratch tapes were eliminated.  thus, the       *  leapr.62   
c     * code takes advantage of the capabilities of large, fast        *  leapr.63   
c     * computers that weren't available to the designers of the       *  leapr.64   
c     * original leap code.  this 1992 version changed to using        *  leapr.65   
c     * the asymmetric s(alpha,beta) for better numerics on            *  leapr.66   
c     * short-word machines, added the mixed moderator capability,     *  leapr.67   
c     * rebuilt the discrete-oscillator calculation for better         *  leapr.68   
c     * accuracy, and made many other smaller improvements.            *  leapr.69   
c     *                                                                *  leapr.70   
c     *----- user input (free format) ---------------------------------*  leapr.71   
c     *                                                                *  leapr.72   
c     * card 1 - units                                                 *  leapr.73   
c     *    nout     endf output unit for thermal file                  *  leapr.74   
c     *                                                                *  leapr.75   
c     * card 2 - title                                                 *  leapr.76   
c     *                                                                *  leapr.77   
c     * card 3 - run control                                           *  leapr.78   
c     *    ntempr  number of temperatures                              *  leapr.79   
c     *    iprint  print control (0=min, 1=more, 2=most, def=1)        *  leapr.80   
c     *    nphon   phonon-expansion order (def=100)                    *  leapr.81   
c     *                                                                *  leapr.82   
c     * card 4 - endf output control                                   *  leapr.83   
c     *    mat     endf mat number                                     *  leapr.84   
c     *    za      1000*z+a for principal scatterer                    *  leapr.85   
c     *    isabt   sab type (0=s, 1=ss, def=0)                         *  leapr.86   
c     *    ilog    log flag (0=s, 1=log10(s), def=0)                   *  leapr.87   
c     *                                                                *  leapr.88   
c     * card 5 - principal scatterer control                           *  leapr.89   
c     *    awr     weight ratio to neutron for principal scatterer     *  leapr.90   
c     *    spr     free atom cross section for principal scatterer     *  leapr.91   
c     *    npr     number of principal scattering atoms in compound    *  leapr.92   
c     *    iel     coherent elastic option                             *  leapr.93   
c     *                   0  none (default)                            *  leapr.94   
c     *                   1  graphite                                  *  leapr.95   
c     *                   2  beryllium                                 *  leapr.96   
c     *                   3  beryllium oxide                           *  leapr.97   
c     *                   4  aluminum                                  *   up86.6    
c     *                   5  lead                                      *   up86.7    
c     *                   6  iron                                      *   up86.8    
c     *    ncold   cold hydrogen option                                *  leapr.98   
c     *                   0   none (default)                           *  leapr.99   
c     *                   1   ortho hydrogen                           *  leapr.100  
c     *                   2   para hydrogen                            *  leapr.101  
c     *                   3   otho deuterium                           *  leapr.102  
c     *                   4   para deuterium                           *  leapr.103  
c     *    nsk            0   none (default)                           *  up114.26   
c     *                   1   vinyard                                  *  up114.27   
c     *                   2   skold                                    *  up114.28   
c     *                                                                *  leapr.104  
c     * card 6 - secondary scatterer control                           *  leapr.105  
c     *    nss     number of secondary scatterers (0 or 1)             *  leapr.106  
c     *    b7      secondary scatterer type                            *  leapr.107  
c     *             (0=sct only, 1=free, 2=diffusion)                  *  leapr.108  
c     *    aws     weight ratio to neutron for secondary scatterer     *  leapr.109  
c     *    sps     free atoms cross section for secondary scatterer    *  leapr.110  
c     *    mss     number of atoms of this type in the compound        *  leapr.111  
c     *                                                                *  leapr.112  
c     * card 7 - alpha, beta control                                   *  leapr.113  
c     *    nalpha   number of alpha values                             *  leapr.114  
c     *    nbeta    number of beta values                              *  leapr.115  
c     *    lat      if lat.eq.1, alpha and beta values are scaled      *  leapr.116  
c     *               by .0253/tev, where tev is temp in ev.  (def=0)  *  leapr.117  
c     *                                                                *  leapr.118  
c     * card 8 - alpha values (increasing order)                       *  leapr.119  
c     * card 9 - beta values (increasing order)                        *  leapr.120  
c     *                                                                *  leapr.121  
c     * scatterer loop, do temperature loop for principal scatterer.   *  leapr.122  
c     *         repeat for secondary scatterer (if any) if b7=0.       *  leapr.123  
c     *                                                                *  leapr.124  
c     * temperature loop, repeat cards 10 to 18 for each temperature   *  leapr.125  
c     *                                                                *  leapr.126  
c     *    card 10 - temperature (k)                                   *  leapr.127  
c     *       a negative value means skip cards 11 to 18,              *  leapr.128  
c     *          thereby using previous parameters for this temp.      *  leapr.129  
c     *                                                                *  leapr.130  
c     *    card 11 -- continuous distribution control                  *  leapr.131  
c     *       delta    interval in ev                                  *  leapr.132  
c     *       ni       number of points                                *  leapr.133  
c     *                                                                *  leapr.134  
c     *    card 12 -- rho(energy) (order of increasing ev)             *  leapr.135  
c     *                                                                *  leapr.136  
c     *    card 13 - continuous distribution parameters                *  leapr.137  
c     *       twt       translational weight                           *  leapr.138  
c     *       c         diffusion constant (zero for free gas)         *  leapr.139  
c     *       tbeta     normalization for continuous part              *  leapr.140  
c     *                                                                *  leapr.141  
c     *    card 14 - discrete oscillator control                       *  leapr.142  
c     *       nd     number of discrete oscillators                    *  leapr.143  
c     *                                                                *  leapr.144  
c     *    card 15 - oscillator energies (ev)                          *  leapr.145  
c     *    card 16 - oscillator weights (sum to 1.-tbeta-twt)          *  leapr.146  
c     *                                                                *  leapr.147  
c     *    card 17 - pair correlation control (nsk.ne.0 only)          *  up114.30   
c     *       nka     number of kappa values                           *  leapr.149  
c     *       dka     kappa increment (inv. angstroms)                 *  leapr.150  
c     *                                                                *  leapr.151  
c     *    card 18  skappa values in increasing order (inv. ang.)      *  leapr.152  
c     *                                                                *  leapr.153  
c     *    card 19 - coherent scattering fraction for nsk.eq.2 only    *  up114.32   
c     *       cfrac   coherent fraction                                *  up114.33   
c     *                                                                *  up114.34   
c     * card 20 - file 1 comments, repeat until blank line is read.    *  up114.35   
c     *                                                                *  leapr.155  
c     ******************************************************************  leapr.156  

GASPR
      subroutine gaspr                                                    gaspr.3    
c     ******************************************************************  gaspr.4    
c     *                                                                *  gaspr.5    
c     * add gas production reactions (mt203-207) to the pendf tape.    *  gaspr.6    
c     * any old gas sections on the input pendf tape are deleted.      *  gaspr.7    
c     * the directory is updated to show the new reactions.            *  gaspr.8    
c     * this module can be run anywhere in the pendf preparation       *  gaspr.9    
c     * sequence as long as it is somewhere after broadr.              *  gaspr.10   
c     * if the input pendf tape omits mt103-mt107, but does have the   *  up244.5    
c     * partial charged particle cross sections they are processed and *  up244.6    
c     * will appear in the appropriate mt20x section.                  *  up244.7    
c     *                                                                *  gaspr.11   
c     *---input specifications (free format)---------------------------*  gaspr.12   
c     *                                                                *  gaspr.13   
c     * card 1                                                         *  gaspr.14   
c     *    nendf    unit for endf/b tape                               *  gaspr.15   
c     *    nin      unit for input pendf tape                          *  gaspr.16   
c     *    nout     unit for output pendf tape                         *  gaspr.17   
c     *                                                                *  gaspr.18   
c     ******************************************************************  gaspr.19   